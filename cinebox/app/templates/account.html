{% extends "base.html" %}

{% block title %}T√†i kho·∫£n c·ªßa t√¥i - CineBox{% endblock %}

{% block content %}
<div class="account-page">
    <div class="account-header">
        <h1>üë§ T√†i kho·∫£n c·ªßa t√¥i</h1>
        <p>Qu·∫£n l√Ω th√¥ng tin c√° nh√¢n v√† danh s√°ch phim c·ªßa b·∫°n</p>
    </div>

    <div class="account-content">
        <!-- Th√¥ng tin c√° nh√¢n -->
        <div class="account-section user-info-section">
            <div class="section-header">
                <h2>üë§ Th√¥ng tin c√° nh√¢n</h2>
                <div style="display: flex; gap: 10px;">
                    <a href="{{ url_for('main.account_history') }}" class="btn btn-info">
                        <span class="btn-icon">üì∫</span>
                        L·ªãch s·ª≠ xem
                    </a>
                    <button class="btn btn-primary" onclick="togglePasswordForm()">
                        <span class="btn-icon">üîí</span>
                        ƒê·ªïi m·∫≠t kh·∫©u
                    </button>
                </div>
            </div>
            
            <div class="user-info-basic">
                <div class="user-avatar-container">
                    <div class="user-avatar-large" onclick="document.getElementById('avatar-upload').click()" title="Click ƒë·ªÉ ƒë·ªïi avatar">
                    {% if user.avatarUrl and user.avatarUrl.startswith('/avatar/') %}
                            <img src="{{ user.avatarUrl }}" alt="Avatar" id="user-avatar-img">
                    {% else %}
                            <img src="{{ user.avatarUrl or url_for('static', filename='img/avatar_default.png') }}" alt="Avatar" id="user-avatar-img">
                    {% endif %}
                        <div class="avatar-overlay">
                            <span class="avatar-upload-icon">üì∑</span>
                </div>
                    </div>
                    <input type="file" id="avatar-upload" accept="image/*" style="display: none;" onchange="uploadAvatar(this)">
                    </div>
                
                <div class="user-details-grid">
                    <!-- C·ªôt tr√°i -->
                    <div class="info-column">
                        <div class="info-item email-item" onclick="editEmail()">
                            <span class="info-icon">üìß</span>
                            <span class="info-label">Email:</span>
                            <span class="info-value" id="email-display">{{ user.email }}</span>
                            <span class="edit-icon">‚úèÔ∏è</span>
                        </div>
                        
                        <div class="info-item">
                            <span class="info-icon">üìÖ</span>
                            <span class="info-label">Tham gia:</span>
                            <span class="info-value">{{ user.createdAt.strftime('%d/%m/%Y') if user.createdAt else 'N/A' }}</span>
                        </div>
                        
                        <div class="info-item">
                            <span class="info-icon">‚úÖ</span>
                            <span class="info-label">Tr·∫°ng th√°i:</span>
                            <span class="info-value">
                                <span class="status-badge {{ 'active' if user.status == 'active' else 'inactive' }}">
                                    {{ user.status or 'Active' }}
                                </span>
                            </span>
                        </div>
                    </div>
                    
                    <!-- C·ªôt ph·∫£i -->
                    <div class="info-column">
                        <div class="info-item username-item" onclick="editUsername()">
                            <span class="info-icon">üë§</span>
                            <span class="info-label">T√™n ng∆∞·ªùi d√πng:</span>
                            <span class="info-value" id="username-display">{{ user.username or 'Ch∆∞a c√≥' }}</span>
                            <span class="edit-icon">‚úèÔ∏è</span>
                        </div>
                        
                        <div class="info-item phone-item" onclick="editPhone()">
                            <span class="info-icon">üì±</span>
                            <span class="info-label">SƒêT:</span>
                            <span class="info-value" id="phone-display">{{ user.phone or 'Ch∆∞a c·∫≠p nh·∫≠t' }}</span>
                            <span class="edit-icon">‚úèÔ∏è</span>
                        </div>
                        
                        <div class="info-item">
                            <span class="info-icon">üè∑Ô∏è</span>
                            <span class="info-label">Vai tr√≤:</span>
                            <span class="info-value">
                                <span class="role-badge {{ 'role-admin' if user.roleName == 'Admin' else 'role-user' }}">
                                    {{ user.roleName }}
                                </span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form ƒë·ªïi m·∫≠t kh·∫©u -->
            <div class="password-form" id="passwordForm" style="display: none;">
                <form method="POST" action="{{ url_for('main.update_password') }}" id="passwordFormElement">
                    <div class="form-group">
                        <label for="current_password">M·∫≠t kh·∫©u hi·ªán t·∫°i:</label>
                        <div class="password-input-wrapper">
                          <input type="password" id="current_password" name="current_password" 
                                 placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i" required>
                          <button type="button" class="toggle-password" onclick="togglePassword('current_password')">
                            <span class="eye-icon">üëÅÔ∏è</span>
                          </button>
                        </div>
                        <small class="form-help">Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i ƒë·ªÉ x√°c th·ª±c</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="new_password">M·∫≠t kh·∫©u m·ªõi:</label>
                        <div class="password-input-wrapper">
                          <input type="password" id="new_password" name="new_password" 
                                 placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi (t·ªëi thi·ªÉu 6 k√Ω t·ª±)"
                                 minlength="6" maxlength="100" required>
                          <button type="button" class="toggle-password" onclick="togglePassword('new_password')">
                            <span class="eye-icon">üëÅÔ∏è</span>
                          </button>
                        </div>
                        <small class="form-help">T·ªëi thi·ªÉu 6 k√Ω t·ª±, t·ªëi ƒëa 100 k√Ω t·ª±</small>
                        <div class="password-strength" id="password-strength" style="display: none;">
                            <div class="password-strength-bar">
                                <div class="strength-fill" id="strength-fill"></div>
                    </div>
                            <span class="strength-text" id="strength-text">M·∫≠t kh·∫©u y·∫øu</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm_password">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi:</label>
                        <div class="password-input-wrapper">
                          <input type="password" id="confirm_password" name="confirm_password" 
                                 placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi" required>
                          <button type="button" class="toggle-password" onclick="togglePassword('confirm_password')">
                            <span class="eye-icon">üëÅÔ∏è</span>
                          </button>
                        </div>
                        <small class="form-help">Ph·∫£i kh·ªõp v·ªõi m·∫≠t kh·∫©u m·ªõi</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ƒê·ªïi m·∫≠t kh·∫©u</button>
                        <button type="button" class="btn btn-secondary" onclick="togglePasswordForm()">H·ªßy</button>
                    </div>
                </form>
            </div>
            
            <!-- Inline edit containers -->
            <div class="phone-edit-container" id="phone-edit-container" style="display: none;">
                <div class="phone-edit-header">
                    <h4>‚úèÔ∏è Ch·ªânh s·ª≠a s·ªë ƒëi·ªán tho·∫°i</h4>
                </div>
                <div class="phone-edit-body">
                    <input type="tel" 
                           class="phone-edit-input" 
                           id="phone-edit-input"
                           placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i m·ªõi"
                           pattern="^(\+84|84|0)[1-9][0-9]{8,9}$"
                           maxlength="20">
                    <div class="phone-edit-actions">
                        <button type="button" class="btn btn-success btn-sm" onclick="savePhone()">
                            üíæ L∆∞u
                        </button>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="cancelPhoneEdit()">
                            ‚ùå H·ªßy
                        </button>
                    </div>
                </div>
            </div>
            
            
        </div>

        <!-- Edit Forms Container -->
        <div class="edit-forms-container" id="edit-forms-container">
            <!-- Edit forms will be dynamically inserted here -->
        </div>

        <!-- Danh s√°ch xem sau -->
        <div class="account-section">
            <div class="section-header">
                <h2>üìã Danh s√°ch xem sau</h2>
                <span class="count-badge">{{ watchlist|length }} phim</span>
            </div>
            
            <!-- Thanh t√¨m ki·∫øm cho watchlist -->
            <div class="search-container">
                <div class="search-form" id="watchlist-search-form">
                    <div class="search-input-group">
                        <input type="text" 
                               id="watchlist-search-input"
                               placeholder="üîç T√¨m phim trong danh s√°ch xem sau..."
                               class="search-input">
                        <button type="button" class="search-btn" title="T√¨m ki·∫øm">
                            <span class="search-icon">üîç</span>
                        </button>
                        <button type="button" class="clear-search-btn" id="clear-watchlist-search" title="X√≥a t√¨m ki·∫øm" style="display: none;">
                            <span class="clear-icon">‚úï</span>
                        </button>
                    </div>
                </div>
            </div>
            
            {% if watchlist %}
                <div class="movie-grid">
                    {% for movie in watchlist %}
                    <div class="movie-card">
                        <a href="{{ url_for('main.detail', movie_id=movie.movieId) }}">
                            <img src="{{ movie.posterUrl or url_for('static', filename='img/poster_default.png') }}" 
                                 alt="{{ movie.title }}" class="movie-poster">
                            <div class="movie-info">
                                <h3>{{ movie.title }}</h3>
                                <p class="movie-year">{{ movie.releaseYear }}</p>
                                <p class="added-date">Th√™m: {{ movie.addedAt.strftime('%d/%m/%Y') if movie.addedAt else 'N/A' }}</p>
                            </div>
                        </a>
                        <button class="remove-btn" onclick="removeFromWatchlist({{ movie.movieId }})" title="X√≥a kh·ªèi danh s√°ch">
                            ‚ùå
                        </button>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Pagination cho watchlist -->
                {% if watchlist_pagination and watchlist_pagination.pages > 1 %}
                <div class="pagination">
                    <div class="pagination-info">
                        <span>Trang {{ watchlist_pagination.page }} / {{ watchlist_pagination.pages }}</span>
                    </div>
                    <div class="pagination-controls">
                        {% if watchlist_pagination.has_prev %}
                            <a href="{{ url_for('main.account', watchlist_page=watchlist_pagination.prev_num, favorites_page=favorites_page, watchlist_search=watchlist_search, favorites_search=favorites_search) }}" class="btn-pagination">‚Äπ Tr∆∞·ªõc</a>
                        {% endif %}
                        
                        <div class="page-numbers">
                            {% for page_num in range(1, watchlist_pagination.pages + 1) %}
                                {% if page_num == watchlist_pagination.page %}
                                    <span class="page-number current">{{ page_num }}</span>
                                {% elif page_num <= 3 or page_num > watchlist_pagination.pages - 3 or (page_num >= watchlist_pagination.page - 1 and page_num <= watchlist_pagination.page + 1) %}
                                    <a href="{{ url_for('main.account', watchlist_page=page_num, favorites_page=favorites_page, watchlist_search=watchlist_search, favorites_search=favorites_search) }}" class="page-number">{{ page_num }}</a>
                                {% elif page_num == 4 or page_num == watchlist_pagination.pages - 3 %}
                                    <span class="page-ellipsis">...</span>
                                {% endif %}
                            {% endfor %}
                        </div>
                        
                        {% if watchlist_pagination.has_next %}
                            <a href="{{ url_for('main.account', watchlist_page=watchlist_pagination.next_num, favorites_page=favorites_page, watchlist_search=watchlist_search, favorites_search=favorites_search) }}" class="btn-pagination">Ti·∫øp ‚Ä∫</a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <p>üì∫ B·∫°n ch∆∞a c√≥ phim n√†o trong danh s√°ch xem sau</p>
                    <a href="{{ url_for('main.home') }}" class="btn btn-primary">Kh√°m ph√° phim</a>
                </div>
            {% endif %}
        </div>

        <!-- Danh s√°ch y√™u th√≠ch -->
        <div class="account-section">
            <div class="section-header">
                <h2>‚ù§Ô∏è Danh s√°ch y√™u th√≠ch</h2>
                <span class="count-badge">{{ favorites|length }} phim</span>
            </div>
            
            <!-- Thanh t√¨m ki·∫øm cho favorites -->
            <div class="search-container">
                <div class="search-form" id="favorites-search-form">
                    <div class="search-input-group">
                        <input type="text" 
                               id="favorites-search-input"
                               placeholder="üîç T√¨m phim trong danh s√°ch y√™u th√≠ch..."
                               class="search-input">
                        <button type="button" class="search-btn" title="T√¨m ki·∫øm">
                            <span class="search-icon">üîç</span>
                        </button>
                        <button type="button" class="clear-search-btn" id="clear-favorites-search" title="X√≥a t√¨m ki·∫øm" style="display: none;">
                            <span class="clear-icon">‚úï</span>
                        </button>
                    </div>
                </div>
            </div>
            
            {% if favorites %}
                <div class="movie-grid">
                    {% for movie in favorites %}
                    <div class="movie-card">
                        <a href="{{ url_for('main.detail', movie_id=movie.movieId) }}">
                            <img src="{{ movie.posterUrl or url_for('static', filename='img/poster_default.png') }}" 
                                 alt="{{ movie.title }}" class="movie-poster">
                            <div class="movie-info">
                                <h3>{{ movie.title }}</h3>
                                <p class="movie-year">{{ movie.releaseYear }}</p>
                                <p class="added-date">Th√™m: {{ movie.addedAt.strftime('%d/%m/%Y') if movie.addedAt else 'N/A' }}</p>
                            </div>
                        </a>
                        <button class="remove-btn" onclick="removeFromFavorites({{ movie.movieId }})" title="X√≥a kh·ªèi y√™u th√≠ch">
                            ‚ùå
                        </button>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Pagination cho favorites -->
                {% if favorites_pagination and favorites_pagination.pages > 1 %}
                <div class="pagination">
                    <div class="pagination-info">
                        <span>Trang {{ favorites_pagination.page }} / {{ favorites_pagination.pages }}</span>
                    </div>
                    <div class="pagination-controls">
                        {% if favorites_pagination.has_prev %}
                            <a href="{{ url_for('main.account', watchlist_page=watchlist_page, favorites_page=favorites_pagination.prev_num, watchlist_search=watchlist_search, favorites_search=favorites_search) }}" class="btn-pagination">‚Äπ Tr∆∞·ªõc</a>
                        {% endif %}
                        
                        <div class="page-numbers">
                            {% for page_num in range(1, favorites_pagination.pages + 1) %}
                                {% if page_num == favorites_pagination.page %}
                                    <span class="page-number current">{{ page_num }}</span>
                                {% elif page_num <= 3 or page_num > favorites_pagination.pages - 3 or (page_num >= favorites_pagination.page - 1 and page_num <= favorites_pagination.page + 1) %}
                                    <a href="{{ url_for('main.account', watchlist_page=watchlist_page, favorites_page=page_num, watchlist_search=watchlist_search, favorites_search=favorites_search) }}" class="page-number">{{ page_num }}</a>
                                {% elif page_num == 4 or page_num == favorites_pagination.pages - 3 %}
                                    <span class="page-ellipsis">...</span>
                                {% endif %}
                            {% endfor %}
                        </div>
                        
                        {% if favorites_pagination.has_next %}
                            <a href="{{ url_for('main.account', watchlist_page=watchlist_page, favorites_page=favorites_pagination.next_num, watchlist_search=watchlist_search, favorites_search=favorites_search) }}" class="btn-pagination">Ti·∫øp ‚Ä∫</a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <p>üíî B·∫°n ch∆∞a c√≥ phim y√™u th√≠ch n√†o</p>
                    <a href="{{ url_for('main.home') }}" class="btn btn-primary">Kh√°m ph√° phim</a>
                </div>
            {% endif %}
        </div>


        <!-- N√∫t ƒëƒÉng xu·∫•t -->
        <div class="account-section logout-section">
            <div class="logout-content">
                <h3>üö™ ƒêƒÉng xu·∫•t kh·ªèi t√†i kho·∫£n</h3>
                <p>B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t kh·ªèi t√†i kho·∫£n hi·ªán t·∫°i?</p>
                <a href="{{ url_for('main.logout') }}" class="btn btn-danger btn-logout">
                    ƒêƒÉng xu·∫•t
                </a>
            </div>
        </div>
    </div>
</div>

<script>
// Toggle password visibility
function togglePassword(inputId) {
  const input = document.getElementById(inputId);
  const button = input.nextElementSibling;
  const icon = button.querySelector('.eye-icon');
  
  if (input.type === 'password') {
    input.type = 'text';
    icon.textContent = 'üôà';
  } else {
    input.type = 'password';
    icon.textContent = 'üëÅÔ∏è';
  }
}

// Toggle edit form
function togglePasswordForm() {
    const form = document.getElementById('passwordForm');
    const isVisible = form.style.display !== 'none';
    form.style.display = isVisible ? 'none' : 'block';
    
    // Smooth animation
    if (!isVisible) {
        form.style.opacity = '0';
        form.style.transform = 'translateY(-20px)';
        setTimeout(() => {
            form.style.transition = 'all 0.3s ease';
            form.style.opacity = '1';
            form.style.transform = 'translateY(0)';
        }, 10);
    }
}

// Avatar upload function
function uploadAvatar(input) {
    if (input.files && input.files[0]) {
        const file = input.files[0];
        
        // Validate file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
            showToast('File qu√° l·ªõn! Vui l√≤ng ch·ªçn file nh·ªè h∆°n 5MB.', 'error');
            return;
        }
        
        // Validate file type
        if (!file.type.startsWith('image/')) {
            showToast('Vui l√≤ng ch·ªçn file ·∫£nh!', 'error');
            return;
        }
        
        // Show loading state
        const avatarImg = document.getElementById('user-avatar-img');
        const originalSrc = avatarImg.src;
        avatarImg.style.opacity = '0.5';
        avatarImg.style.transform = 'scale(0.95)';
        
        // Create FormData
        const formData = new FormData();
        formData.append('avatar', file);
        
        // Upload to server
        fetch('/upload-avatar', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update avatar immediately
                avatarImg.src = data.avatar_url + '?t=' + new Date().getTime();
                avatarImg.style.opacity = '1';
                avatarImg.style.transform = 'scale(1)';
                
                // Show success animation
                avatarImg.style.transition = 'all 0.3s ease';
                avatarImg.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    avatarImg.style.transform = 'scale(1)';
                }, 200);
                
                showToast('‚úÖ ƒê·ªïi avatar th√†nh c√¥ng!', 'success');
            } else {
                // Restore original avatar
                avatarImg.src = originalSrc;
                avatarImg.style.opacity = '1';
                avatarImg.style.transform = 'scale(1)';
                showToast('‚ùå ' + (data.error || 'Kh√¥ng th·ªÉ ƒë·ªïi avatar'), 'error');
            }
        })
        .catch(error => {
            // Restore original avatar
            avatarImg.src = originalSrc;
            avatarImg.style.opacity = '1';
            avatarImg.style.transform = 'scale(1)';
            console.error('Error:', error);
            showToast('‚ùå L·ªói: Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server', 'error');
        });
    }
}

// Phone edit inline function
function editPhone() {
    const phoneItem = document.querySelector('.phone-item');
    const phoneDisplay = document.getElementById('phone-display');
    const currentPhone = phoneDisplay.textContent;
    
    // Clear all edit containers
    clearAllEditContainers();
    
    // Create new container
    const editContainer = document.createElement('div');
    editContainer.id = 'phone-edit-container';
    editContainer.className = 'phone-edit-container';
    editContainer.innerHTML = `
        <div class="phone-edit-header">
            <h4>üì± Ch·ªânh s·ª≠a s·ªë ƒëi·ªán tho·∫°i</h4>
            <p class="phone-edit-description">C·∫≠p nh·∫≠t s·ªë ƒëi·ªán tho·∫°i li√™n l·∫°c c·ªßa b·∫°n. S·ªë ƒëi·ªán tho·∫°i s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x√°c th·ª±c t√†i kho·∫£n.</p>
        </div>
        <div class="phone-edit-body">
            <div class="phone-edit-field">
                <label for="phone-edit-input" class="phone-edit-label">S·ªë ƒëi·ªán tho·∫°i:</label>
                <input type="tel" 
                       class="phone-edit-input" 
                       id="phone-edit-input"
                       placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i (VD: 0123456789)" 
                       value="${currentPhone === 'Ch∆∞a c·∫≠p nh·∫≠t' ? '' : currentPhone}"
                       pattern="^(\+84|84|0)[1-9][0-9]{8,9}$"
                       minlength="10"
                       maxlength="15">
                <div class="phone-edit-help">
                    <span class="help-text">üí° ƒê·ªãnh d·∫°ng: S·ªë ƒëi·ªán tho·∫°i Vi·ªát Nam (VD: 0123456789, +84123456789)</span>
                </div>
            </div>
            <div class="phone-edit-actions">
                <button class="btn-save" onclick="savePhone()">
                    <span class="btn-icon">üíæ</span>
                    L∆∞u thay ƒë·ªïi
                </button>
                <button class="btn-cancel" onclick="cancelPhoneEdit()">
                    <span class="btn-icon">‚ùå</span>
                    H·ªßy b·ªè
                </button>
            </div>
        </div>
    `;
    // Append to edit forms container
    const editFormsContainer = document.getElementById('edit-forms-container');
    editFormsContainer.appendChild(editContainer);
    
    // Show edit container
    editContainer.classList.add('show');
    const phoneInput = editContainer.querySelector('.phone-edit-input');
    phoneInput.focus();
    phoneInput.select();
    
    // Add real-time validation
    phoneInput.addEventListener('input', function() {
        const value = this.value;
        const helpText = editContainer.querySelector('.help-text');
        
        if (value.length === 0) {
            helpText.textContent = 'üí° ƒê·ªãnh d·∫°ng: 10-15 ch·ªØ s·ªë, c√≥ th·ªÉ ch·ª©a d·∫•u +, -, (), kho·∫£ng tr·∫Øng';
            helpText.style.color = '#64748b';
        } else if (value.length < 10) {
            helpText.textContent = '‚ö†Ô∏è S·ªë ƒëi·ªán tho·∫°i qu√° ng·∫Øn (t·ªëi thi·ªÉu 10 ch·ªØ s·ªë)';
            helpText.style.color = '#f59e0b';
        } else if (value.length > 15) {
            helpText.textContent = '‚ö†Ô∏è S·ªë ƒëi·ªán tho·∫°i qu√° d√†i (t·ªëi ƒëa 15 ch·ªØ s·ªë)';
            helpText.style.color = '#f59e0b';
        } else if (!/^[0-9+\-\s()]+$/.test(value)) {
            helpText.textContent = '‚ùå Ch·ªâ ƒë∆∞·ª£c ch·ª©a s·ªë, d·∫•u +, -, (), kho·∫£ng tr·∫Øng';
            helpText.style.color = '#ef4444';
        } else {
            helpText.textContent = '‚úÖ ƒê·ªãnh d·∫°ng s·ªë ƒëi·ªán tho·∫°i h·ª£p l·ªá';
            helpText.style.color = '#10b981';
        }
    });
}

    function savePhone() {
        const editContainer = document.getElementById('phone-edit-container');
        const phoneInput = editContainer.querySelector('.phone-edit-input');
        const newPhone = phoneInput.value.trim();
        const phoneDisplay = document.getElementById('phone-display');
    
    // Validate phone number
    if (newPhone) {
        if (newPhone.length < 10) {
            showToast('‚ùå S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ √≠t nh·∫•t 10 ch·ªØ s·ªë!', 'error');
            return;
        }
        if (newPhone.length > 15) {
            showToast('‚ùå S·ªë ƒëi·ªán tho·∫°i kh√¥ng ƒë∆∞·ª£c qu√° 15 ch·ªØ s·ªë!', 'error');
            return;
        }
        if (!/^(\+84|84|0)[1-9][0-9]{8,9}$/.test(newPhone)) {
            showToast('‚ùå S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá. Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i Vi·ªát Nam (10-11 s·ªë)!', 'error');
            return;
        }
    }
    
    // Show loading
    phoneDisplay.style.opacity = '0.5';
    
    // Call API to update phone
    fetch('/api/update-phone', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ phone: newPhone })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update display
            phoneDisplay.textContent = newPhone || 'Ch∆∞a c·∫≠p nh·∫≠t';
            phoneDisplay.style.opacity = '1';
            
            // Show success animation
            phoneDisplay.style.transition = 'all 0.3s ease';
            phoneDisplay.style.color = '#28a745';
            setTimeout(() => {
                phoneDisplay.style.color = '#fff';
            }, 1000);
            
            showToast(data.message, 'success');
            cancelPhoneEdit();
        } else {
            phoneDisplay.style.opacity = '1';
            showToast(data.message, 'error');
        }
    })
    .catch(error => {
        phoneDisplay.style.opacity = '1';
        showToast('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t s·ªë ƒëi·ªán tho·∫°i', 'error');
        console.error('Error:', error);
    });
}

    function cancelPhoneEdit() {
        const editContainer = document.getElementById('phone-edit-container');
        if (editContainer) {
            editContainer.classList.remove('show');
            setTimeout(() => {
                editContainer.remove();
            }, 300);
        }
    }
    
    // Username editing functions
    function editUsername() {
        const usernameItem = document.querySelector('.username-item');
        const usernameDisplay = document.getElementById('username-display');
        const currentUsername = usernameDisplay.textContent;
        
        // Clear all edit containers
        clearAllEditContainers();
        
        // Create new container
        const editContainer = document.createElement('div');
        editContainer.id = 'username-edit-container';
        editContainer.className = 'username-edit-container';
        editContainer.innerHTML = `
            <div class="username-edit-header">
                <h4>üë§ Ch·ªânh s·ª≠a t√™n ng∆∞·ªùi d√πng</h4>
                <p class="username-edit-description">C·∫≠p nh·∫≠t t√™n ng∆∞·ªùi d√πng c·ªßa b·∫°n. T√™n ng∆∞·ªùi d√πng ph·∫£i duy nh·∫•t v√† s·∫Ω hi·ªÉn th·ªã tr√™n trang c√° nh√¢n.</p>
            </div>
            <div class="username-edit-body">
                <div class="username-edit-field">
                    <label for="username-edit-input" class="username-edit-label">T√™n ng∆∞·ªùi d√πng:</label>
                    <input type="text" 
                           class="username-edit-input" 
                           id="username-edit-input"
                           placeholder="Nh·∫≠p t√™n ng∆∞·ªùi d√πng m·ªõi (VD: Nguy·ªÖn VƒÉn A, john_doe)" 
                           value="${currentUsername === 'Ch∆∞a c√≥' ? '' : currentUsername}"
                           pattern="^[a-zA-Z0-9._\u00C0-\u017F\u1E00-\u1EFF\u0100-\u017F\u0180-\u024F -]+$"
                           minlength="3"
                           maxlength="100">
                    <div class="username-edit-help">
                        <span class="help-text">üí° ƒê·ªãnh d·∫°ng: 3-100 k√Ω t·ª±, ch·ªØ c√°i (c√≥ d·∫•u), s·ªë, d·∫•u ch·∫•m, g·∫°ch d∆∞·ªõi, g·∫°ch ngang, kho·∫£ng tr·∫Øng</span>
                    </div>
                </div>
                <div class="username-edit-actions">
                    <button class="btn-save" onclick="saveUsername()">
                        <span class="btn-icon">üíæ</span>
                        L∆∞u thay ƒë·ªïi
                    </button>
                    <button class="btn-cancel" onclick="cancelUsernameEdit()">
                        <span class="btn-icon">‚ùå</span>
                        H·ªßy b·ªè
                    </button>
                </div>
            </div>
        `;
        
        // Append to edit forms container
        const editFormsContainer = document.getElementById('edit-forms-container');
        editFormsContainer.appendChild(editContainer);
        
        editContainer.style.display = 'block';
        editContainer.classList.add('show');
        const usernameInput = editContainer.querySelector('.username-edit-input');
        usernameInput.focus();
        usernameInput.select();
        
        // Add real-time validation
        usernameInput.addEventListener('input', function() {
            const value = this.value;
            const helpText = editContainer.querySelector('.help-text');
            
            if (value.length === 0) {
                helpText.textContent = 'üí° ƒê·ªãnh d·∫°ng: 3-100 k√Ω t·ª±, ch·ªØ c√°i (c√≥ d·∫•u), s·ªë, d·∫•u ch·∫•m, g·∫°ch d∆∞·ªõi, g·∫°ch ngang, kho·∫£ng tr·∫Øng';
                helpText.style.color = '#64748b';
            } else if (value.length < 3) {
                helpText.textContent = '‚ö†Ô∏è T√™n ng∆∞·ªùi d√πng qu√° ng·∫Øn (t·ªëi thi·ªÉu 3 k√Ω t·ª±)';
                helpText.style.color = '#f59e0b';
            } else if (value.length > 100) {
                helpText.textContent = '‚ö†Ô∏è T√™n ng∆∞·ªùi d√πng qu√° d√†i (t·ªëi ƒëa 100 k√Ω t·ª±)';
                helpText.style.color = '#f59e0b';
            } else if (!/^[a-zA-Z0-9._\u00C0-\u017F\u1E00-\u1EFF\u0100-\u017F\u0180-\u024F -]+$/.test(value)) {
                helpText.textContent = '‚ùå Ch·ªâ ƒë∆∞·ª£c ch·ª©a ch·ªØ c√°i (c√≥ d·∫•u), s·ªë, d·∫•u ch·∫•m, g·∫°ch d∆∞·ªõi, g·∫°ch ngang, kho·∫£ng tr·∫Øng';
                helpText.style.color = '#ef4444';
            } else {
                helpText.textContent = '‚úÖ ƒê·ªãnh d·∫°ng t√™n ng∆∞·ªùi d√πng h·ª£p l·ªá';
                helpText.style.color = '#10b981';
            }
        });
    }
    
    function saveUsername() {
        const editContainer = document.getElementById('username-edit-container');
        const usernameInput = editContainer.querySelector('.username-edit-input');
        const newUsername = usernameInput.value.trim();
        const usernameDisplay = document.getElementById('username-display');
        
        // Validate username
        const usernamePattern = /^[a-zA-Z0-9._\u00C0-\u017F\u1E00-\u1EFF\u0100-\u017F\u0180-\u024F -]+$/;
        if (!newUsername) {
            showToast('Vui l√≤ng nh·∫≠p t√™n ng∆∞·ªùi d√πng', 'error');
            return;
        }
        
        if (newUsername.length < 3) {
            showToast('‚ùå T√™n ng∆∞·ªùi d√πng ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±!', 'error');
            return;
        }
        
        if (newUsername.length > 100) {
            showToast('‚ùå T√™n ng∆∞·ªùi d√πng kh√¥ng ƒë∆∞·ª£c qu√° 100 k√Ω t·ª±!', 'error');
            return;
        }
        
        if (!usernamePattern.test(newUsername)) {
            showToast('‚ùå T√™n ng∆∞·ªùi d√πng ch·ªâ ƒë∆∞·ª£c ch·ª©a ch·ªØ c√°i (c√≥ d·∫•u), s·ªë, d·∫•u ch·∫•m, g·∫°ch d∆∞·ªõi, g·∫°ch ngang v√† kho·∫£ng tr·∫Øng!', 'error');
            return;
        }
        
        // Call API to update username
        fetch('/api/update-username', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username: newUsername })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update display
                usernameDisplay.textContent = newUsername;
                
                // Hide edit container
                editContainer.classList.remove('show');
                setTimeout(() => {
                    editContainer.remove();
                    activeEditForm = null;
                }, 300);
                
                showToast(data.message, 'success');
            } else {
                showToast(data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showToast('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t t√™n ƒëƒÉng nh·∫≠p', 'error');
        });
    }
    
    function cancelUsernameEdit() {
        const editContainer = document.getElementById('username-edit-container');
        if (editContainer) {
            editContainer.classList.remove('show');
            setTimeout(() => {
                editContainer.remove();
            }, 300);
        }
    }
    
    // Global variable to track active edit form
    let activeEditForm = null;

    // Function to clear all edit containers
    function clearAllEditContainers() {
        // Clear edit forms container
        const editFormsContainer = document.getElementById('edit-forms-container');
        if (editFormsContainer) {
            editFormsContainer.innerHTML = '';
        }
        
        // Also remove any containers that might exist elsewhere
        const existingContainers = [
            'email-edit-container',
            'username-edit-container', 
            'phone-edit-container'
        ];
        
        existingContainers.forEach(id => {
            const container = document.getElementById(id);
            if (container) {
                container.remove();
            }
        });
        
        activeEditForm = null;
    }

    // Email editing functions
    function editEmail() {
        // If already editing email, do nothing
        if (activeEditForm === 'email') {
            return;
        }
        
        const emailItem = document.querySelector('.email-item');
        const emailDisplay = document.getElementById('email-display');
        const currentEmail = emailDisplay.textContent;
        
        // Clear all edit containers
        clearAllEditContainers();
        
        // Create new container
        const editContainer = document.createElement('div');
        editContainer.id = 'email-edit-container';
        editContainer.className = 'email-edit-container';
        editContainer.innerHTML = `
            <div class="email-edit-header">
                <h4>üìß Ch·ªânh s·ª≠a email</h4>
                <p class="email-edit-description">C·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ email c·ªßa b·∫°n. Email s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x√°c th·ª±c t√†i kho·∫£n v√† nh·∫≠n th√¥ng b√°o quan tr·ªçng.</p>
            </div>
            <div class="email-edit-body">
                <div class="email-edit-field">
                    <label for="email-edit-input" class="email-edit-label">ƒê·ªãa ch·ªâ email:</label>
                    <input type="email" 
                           class="email-edit-input" 
                           id="email-edit-input"
                           placeholder="Nh·∫≠p email m·ªõi (VD: user@example.com)" 
                           value="${currentEmail}"
                           pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                           maxlength="255">
                    <div class="email-edit-help">
                        <span class="help-text">üí° ƒê·ªãnh d·∫°ng: user@domain.com (t·ªëi ƒëa 255 k√Ω t·ª±)</span>
                    </div>
                </div>
                <div class="email-edit-actions">
                    <button class="btn-save" onclick="saveEmail()">
                        <span class="btn-icon">üíæ</span>
                        L∆∞u thay ƒë·ªïi
                    </button>
                    <button class="btn-cancel" onclick="cancelEmailEdit()">
                        <span class="btn-icon">‚ùå</span>
                        H·ªßy b·ªè
                    </button>
                </div>
            </div>
        `;
        
        // Append to edit forms container
        const editFormsContainer = document.getElementById('edit-forms-container');
        editFormsContainer.appendChild(editContainer);
        
        editContainer.style.display = 'block';
        editContainer.classList.add('show');
        const emailInput = editContainer.querySelector('.email-edit-input');
        emailInput.focus();
        emailInput.select();
        
        // Set active form
        activeEditForm = 'email';
        
        // Add real-time validation
        emailInput.addEventListener('input', function() {
            const value = this.value;
            const helpText = editContainer.querySelector('.help-text');
            
            if (value.length === 0) {
                helpText.textContent = 'üí° ƒê·ªãnh d·∫°ng: user@domain.com (t·ªëi ƒëa 255 k√Ω t·ª±)';
                helpText.style.color = '#64748b';
            } else if (value.length > 255) {
                helpText.textContent = '‚ö†Ô∏è Email qu√° d√†i (t·ªëi ƒëa 255 k√Ω t·ª±)';
                helpText.style.color = '#f59e0b';
            } else if (!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(value)) {
                helpText.textContent = '‚ùå ƒê·ªãnh d·∫°ng email kh√¥ng h·ª£p l·ªá (VD: user@example.com)';
                helpText.style.color = '#ef4444';
            } else {
                helpText.textContent = '‚úÖ ƒê·ªãnh d·∫°ng email h·ª£p l·ªá';
                helpText.style.color = '#10b981';
            }
        });
    }
    
    function saveEmail() {
        const editContainer = document.getElementById('email-edit-container');
        const emailInput = editContainer.querySelector('.email-edit-input');
        const newEmail = emailInput.value.trim();
        const emailDisplay = document.getElementById('email-display');
        
        // Validate email
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if (!newEmail) {
            showToast('Vui l√≤ng nh·∫≠p email', 'error');
            return;
        }
        
        if (!emailPattern.test(newEmail)) {
            showToast('‚ùå ƒê·ªãnh d·∫°ng email kh√¥ng h·ª£p l·ªá!', 'error');
            return;
        }
        
        if (newEmail.length > 255) {
            showToast('‚ùå Email kh√¥ng ƒë∆∞·ª£c qu√° 255 k√Ω t·ª±!', 'error');
            return;
        }
        
        // Call API to update email
        fetch('/api/update-email', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email: newEmail })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update display
                emailDisplay.textContent = newEmail;
                
                // Hide edit container
                editContainer.classList.remove('show');
                setTimeout(() => {
                    editContainer.remove();
                    activeEditForm = null;
                }, 300);
                
                showToast(data.message, 'success');
            } else {
                showToast(data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showToast('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t email', 'error');
        });
    }
    
    function cancelEmailEdit() {
        const editContainer = document.getElementById('email-edit-container');
        if (editContainer) {
            editContainer.classList.remove('show');
            setTimeout(() => {
                editContainer.remove();
                activeEditForm = null;
            }, 300);
        }
    }

// Toast notification function
function showToast(message, type = 'success') {
    // Remove existing toast
    const existingToast = document.querySelector('.toast-notification');
    if (existingToast) {
        existingToast.remove();
    }
    
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast-notification ${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <span class="toast-message">${message}</span>
        </div>
    `;
    
    // Add styles
    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#28a745' : '#dc3545'};
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        transform: translateX(400px);
        transition: transform 0.3s ease-in-out;
        max-width: 300px;
        border-left: 4px solid ${type === 'success' ? '#20c997' : '#c82333'};
    `;
    
    document.body.appendChild(toast);
    
    // Show toast
    setTimeout(() => {
        toast.style.transform = 'translateX(0)';
    }, 10);
    
    // Auto hide after 3 seconds
    setTimeout(() => {
        toast.style.transform = 'translateX(400px)';
        setTimeout(() => {
            if (toast.parentNode) {
                toast.remove();
            }
        }, 300);
    }, 3000);
}

// Remove from watchlist
function removeFromWatchlist(movieId) {
    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a phim n√†y kh·ªèi danh s√°ch xem sau?')) {
        fetch(`/remove-watchlist/${movieId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast('‚úÖ ' + data.message, 'success');
                setTimeout(() => location.reload(), 1000);
            } else {
                showToast('‚ùå ' + data.message, 'error');
            }
        })
        .catch(error => {
            showToast('‚ùå C√≥ l·ªói x·∫£y ra', 'error');
            console.error('Error:', error);
        });
    }
}

// Remove from favorites
function removeFromFavorites(movieId) {
    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a phim n√†y kh·ªèi danh s√°ch y√™u th√≠ch?')) {
        fetch(`/remove-favorite/${movieId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast('‚úÖ ' + data.message, 'success');
                setTimeout(() => location.reload(), 1000);
            } else {
                showToast('‚ùå ' + data.message, 'error');
            }
        })
        .catch(error => {
            showToast('‚ùå C√≥ l·ªói x·∫£y ra', 'error');
            console.error('Error:', error);
        });
    }
}

// Close phone edit when clicking outside
document.addEventListener('click', function(e) {
    const phoneItem = document.querySelector('.phone-item');
    const usernameItem = document.querySelector('.username-item');
    const emailItem = document.querySelector('.email-item');
    const phoneEditContainer = document.querySelector('.phone-edit-container');
    const usernameEditContainer = document.getElementById('username-edit-container');
    const emailEditContainer = document.getElementById('email-edit-container');
    
    if (phoneEditContainer && phoneEditContainer.classList.contains('show') && 
        !phoneItem.contains(e.target)) {
        cancelPhoneEdit();
    }
    
    if (usernameEditContainer && usernameEditContainer.classList.contains('show') && 
        !usernameItem.contains(e.target)) {
        cancelUsernameEdit();
    }
    
    if (emailEditContainer && emailEditContainer.classList.contains('show') && 
        !emailItem.contains(e.target)) {
        cancelEmailEdit();
    }
});

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    // Add smooth animations to info items
    const infoItems = document.querySelectorAll('.info-item');
    infoItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        setTimeout(() => {
            item.style.transition = 'all 0.3s ease';
            item.style.opacity = '1';
            item.style.transform = 'translateY(0)';
        }, index * 100);
    });
    
    // Add hover effects to avatar
    const avatar = document.querySelector('.user-avatar-large');
    if (avatar) {
        avatar.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.05) rotate(2deg)';
        });
        
        avatar.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1) rotate(0deg)';
        });
    }
});

// Search functionality with AJAX
document.addEventListener('DOMContentLoaded', function() {
    // Watchlist search - t√¨m element ch√≠nh x√°c h∆°n
    const watchlistSearchInput = document.getElementById('watchlist-search-input');
    // T√¨m section ch·ª©a "Danh s√°ch xem sau"
    let watchlistSection = null;
    const allSections = document.querySelectorAll('.account-section');
    for (let section of allSections) {
        const h2 = section.querySelector('h2');
        if (h2 && h2.textContent.includes('Danh s√°ch xem sau')) {
            watchlistSection = section;
            break;
        }
    }
    // Fallback: d√πng index n·∫øu kh√¥ng t√¨m th·∫•y
    if (!watchlistSection && allSections.length > 1) {
        watchlistSection = allSections[1];
    }
    const watchlistMovieGrid = watchlistSection ? watchlistSection.querySelector('.movie-grid') : null;
    const watchlistPagination = watchlistSection ? watchlistSection.querySelector('.pagination') : null;
    const watchlistCountBadge = watchlistSection ? watchlistSection.querySelector('.count-badge') : null;
    
    // Debug
    console.log('Watchlist elements:', {
        section: watchlistSection,
        grid: watchlistMovieGrid,
        pagination: watchlistPagination,
        badge: watchlistCountBadge
    });
    
    if (watchlistSearchInput) {
        let watchlistSearchTimeout;
        let currentWatchlistPage = 1;
        const clearWatchlistBtn = document.getElementById('clear-watchlist-search');
        
        watchlistSearchInput.addEventListener('input', function() {
            const query = this.value.trim();
            
            // Show/hide clear button
            if (query.length > 0) {
                clearWatchlistBtn.style.display = 'flex';
            } else {
                clearWatchlistBtn.style.display = 'none';
            }
            
            clearTimeout(watchlistSearchTimeout);
            watchlistSearchTimeout = setTimeout(() => {
                currentWatchlistPage = 1; // Reset to first page when searching
                searchWatchlist(query, 1);
            }, 500);
        });
        
        // Submit on Enter
        watchlistSearchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                clearTimeout(watchlistSearchTimeout);
                currentWatchlistPage = 1;
                searchWatchlist(this.value.trim(), 1);
            }
        });
        
        // Clear search
        clearWatchlistBtn.addEventListener('click', function() {
            watchlistSearchInput.value = '';
            clearWatchlistBtn.style.display = 'none';
            currentWatchlistPage = 1;
            searchWatchlist('', 1);
        });
    }
    
    // Favorites search - t√¨m element ch√≠nh x√°c h∆°n
    const favoritesSearchInput = document.getElementById('favorites-search-input');
    // T√¨m section ch·ª©a "Danh s√°ch y√™u th√≠ch"
    let favoritesSection = null;
    const allSections2 = document.querySelectorAll('.account-section');
    for (let section of allSections2) {
        const h2 = section.querySelector('h2');
        if (h2 && h2.textContent.includes('Danh s√°ch y√™u th√≠ch')) {
            favoritesSection = section;
            break;
        }
    }
    // Fallback: d√πng index n·∫øu kh√¥ng t√¨m th·∫•y
    if (!favoritesSection && allSections2.length > 2) {
        favoritesSection = allSections2[2];
    }
    const favoritesMovieGrid = favoritesSection ? favoritesSection.querySelector('.movie-grid') : null;
    const favoritesPagination = favoritesSection ? favoritesSection.querySelector('.pagination') : null;
    const favoritesCountBadge = favoritesSection ? favoritesSection.querySelector('.count-badge') : null;
    
    // Debug
    console.log('Favorites elements:', {
        section: favoritesSection,
        grid: favoritesMovieGrid,
        pagination: favoritesPagination,
        badge: favoritesCountBadge
    });
    
    if (favoritesSearchInput) {
        let favoritesSearchTimeout;
        let currentFavoritesPage = 1;
        const clearFavoritesBtn = document.getElementById('clear-favorites-search');
        
        favoritesSearchInput.addEventListener('input', function() {
            const query = this.value.trim();
            
            // Show/hide clear button
            if (query.length > 0) {
                clearFavoritesBtn.style.display = 'flex';
            } else {
                clearFavoritesBtn.style.display = 'none';
            }
            
            clearTimeout(favoritesSearchTimeout);
            favoritesSearchTimeout = setTimeout(() => {
                currentFavoritesPage = 1; // Reset to first page when searching
                searchFavorites(query, 1);
            }, 500);
        });
        
        // Submit on Enter
        favoritesSearchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                clearTimeout(favoritesSearchTimeout);
                currentFavoritesPage = 1;
                searchFavorites(this.value.trim(), 1);
            }
        });
        
        // Clear search
        clearFavoritesBtn.addEventListener('click', function() {
            favoritesSearchInput.value = '';
            clearFavoritesBtn.style.display = 'none';
            currentFavoritesPage = 1;
            searchFavorites('', 1);
        });
    }
    
    // AJAX search function for watchlist
    function searchWatchlist(query, page) {
        if (!watchlistMovieGrid) return;
        
        // Show loading state
        watchlistMovieGrid.innerHTML = '<div class="loading-spinner">üîç ƒêang t√¨m ki·∫øm...</div>';
        
        fetch(`/api/search-watchlist?q=${encodeURIComponent(query)}&page=${page}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateWatchlistUI(data.movies, data.pagination, query);
                } else {
                    showToast('‚ùå L·ªói t√¨m ki·∫øm: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Search error:', error);
                showToast('‚ùå L·ªói k·∫øt n·ªëi', 'error');
            });
    }
    
    // AJAX search function for favorites
    function searchFavorites(query, page) {
        if (!favoritesMovieGrid) return;
        
        // Show loading state
        favoritesMovieGrid.innerHTML = '<div class="loading-spinner">üîç ƒêang t√¨m ki·∫øm...</div>';
        
        fetch(`/api/search-favorites?q=${encodeURIComponent(query)}&page=${page}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateFavoritesUI(data.movies, data.pagination, query);
                } else {
                    showToast('‚ùå L·ªói t√¨m ki·∫øm: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Search error:', error);
                showToast('‚ùå L·ªói k·∫øt n·ªëi', 'error');
            });
    }
    
    // Update watchlist UI
    function updateWatchlistUI(movies, pagination, query) {
        // Update movie grid
        if (movies.length === 0) {
            watchlistMovieGrid.innerHTML = `
                <div class="empty-state">
                    <p>üíî ${query ? `Kh√¥ng t√¨m th·∫•y phim n√†o v·ªõi t·ª´ kh√≥a "${query}"` : 'B·∫°n ch∆∞a c√≥ phim n√†o trong danh s√°ch xem sau'}</p>
                    ${!query ? '<a href="/" class="btn btn-primary">Kh√°m ph√° phim</a>' : ''}
                </div>
            `;
        } else {
            let moviesHTML = '';
            movies.forEach(movie => {
                moviesHTML += `
                    <div class="movie-card">
                        <a href="/movie/${movie.id}">
                            <img src="${movie.poster}" alt="${movie.title}" class="movie-poster">
                            <div class="movie-info">
                                <h3>${movie.title}</h3>
                                <p class="movie-year">${movie.year || 'N/A'}</p>
                                <p class="added-date">Th√™m: ${movie.addedAt}</p>
                            </div>
                        </a>
                        <button class="remove-btn" onclick="removeFromWatchlist(${movie.id})" title="X√≥a kh·ªèi danh s√°ch">
                            ‚ùå
                        </button>
                    </div>
                `;
            });
            watchlistMovieGrid.innerHTML = moviesHTML;
        }
        
        // Update count badge
        if (watchlistCountBadge) {
            watchlistCountBadge.textContent = `${movies.length} phim`;
        }
        
        // Update pagination
        updatePagination(watchlistPagination, pagination, 'watchlist', query);
    }
    
    // Update favorites UI
    function updateFavoritesUI(movies, pagination, query) {
        // Update movie grid
        if (movies.length === 0) {
            favoritesMovieGrid.innerHTML = `
                <div class="empty-state">
                    <p>üíî ${query ? `Kh√¥ng t√¨m th·∫•y phim n√†o v·ªõi t·ª´ kh√≥a "${query}"` : 'B·∫°n ch∆∞a c√≥ phim y√™u th√≠ch n√†o'}</p>
                    ${!query ? '<a href="/" class="btn btn-primary">Kh√°m ph√° phim</a>' : ''}
                </div>
            `;
        } else {
            let moviesHTML = '';
            movies.forEach(movie => {
                moviesHTML += `
                    <div class="movie-card">
                        <a href="/movie/${movie.id}">
                            <img src="${movie.poster}" alt="${movie.title}" class="movie-poster">
                            <div class="movie-info">
                                <h3>${movie.title}</h3>
                                <p class="movie-year">${movie.year || 'N/A'}</p>
                                <p class="added-date">Th√™m: ${movie.addedAt}</p>
                            </div>
                        </a>
                        <button class="remove-btn" onclick="removeFromFavorites(${movie.id})" title="X√≥a kh·ªèi danh s√°ch">
                            ‚ùå
                        </button>
                    </div>
                `;
            });
            favoritesMovieGrid.innerHTML = moviesHTML;
        }
        
        // Update count badge
        if (favoritesCountBadge) {
            favoritesCountBadge.textContent = `${movies.length} phim`;
        }
        
        // Update pagination
        updatePagination(favoritesPagination, pagination, 'favorites', query);
    }
    
    // Update pagination
    function updatePagination(paginationElement, pagination, type, query) {
        if (!paginationElement || !pagination) return;
        
        // H·ªó tr·ª£ c·∫£ hai format: current_page/total_pages v√† page/pages
        const currentPage = pagination.current_page || pagination.page || 1;
        const totalPages = pagination.total_pages || pagination.pages || 1;
        const hasPrev = pagination.has_prev !== undefined ? pagination.has_prev : (currentPage > 1);
        const hasNext = pagination.has_next !== undefined ? pagination.has_next : (currentPage < totalPages);
        const prevNum = pagination.prev_num || (currentPage > 1 ? currentPage - 1 : null);
        const nextNum = pagination.next_num || (currentPage < totalPages ? currentPage + 1 : null);
        
        if (totalPages <= 1) {
            paginationElement.style.display = 'none';
            return;
        }
        
        paginationElement.style.display = 'block';
        
        let paginationHTML = `
            <div class="pagination-info">
                <span>Trang ${currentPage} / ${totalPages}</span>
            </div>
            <div class="pagination-controls">
        `;
        
        // Previous button
        if (hasPrev && prevNum) {
            paginationHTML += `<button class="btn-pagination" onclick="loadPage('${type}', ${prevNum}, '${query}')">‚Üê Trang tr∆∞·ªõc</button>`;
        } else {
            paginationHTML += `<span class="btn-pagination" style="opacity: 0.5; cursor: not-allowed;">‚Üê Trang tr∆∞·ªõc</span>`;
        }
        
        // Page numbers
        paginationHTML += '<div class="page-numbers">';
        for (let i = 1; i <= totalPages; i++) {
            if (i === currentPage) {
                paginationHTML += `<span class="page-number current">${i}</span>`;
            } else if (i <= 3 || i > totalPages - 3 || (i >= currentPage - 1 && i <= currentPage + 1)) {
                paginationHTML += `<button class="page-number" onclick="loadPage('${type}', ${i}, '${query}')">${i}</button>`;
            } else if (i === 4 || i === totalPages - 3) {
                paginationHTML += `<span class="page-ellipsis">...</span>`;
            }
        }
        paginationHTML += '</div>';
        
        // Next button
        if (hasNext && nextNum) {
            paginationHTML += `<button class="btn-pagination" onclick="loadPage('${type}', ${nextNum}, '${query}')">Trang sau ‚Üí</button>`;
        } else {
            paginationHTML += `<span class="btn-pagination" style="opacity: 0.5; cursor: not-allowed;">Trang sau ‚Üí</span>`;
        }
        
        paginationHTML += '</div>';
        paginationElement.innerHTML = paginationHTML;
    }
    
    // Global function to load page
    window.loadPage = function(type, page, query) {
        if (type === 'watchlist') {
            currentWatchlistPage = page;
            searchWatchlist(query, page);
        } else if (type === 'favorites') {
            currentFavoritesPage = page;
            searchFavorites(query, page);
        }
    };
    
    // Form validation
    const profileForm = document.getElementById('profileForm');
    if (profileForm) {
        // Phone validation
        const phoneInput = document.getElementById('phone');
        if (phoneInput) {
            phoneInput.addEventListener('input', function() {
                const phonePattern = /^(\+84|84|0)[1-9][0-9]{8,9}$/;
                if (this.value && !phonePattern.test(this.value)) {
                    this.setCustomValidity('S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá. Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i Vi·ªát Nam.');
                } else {
                    this.setCustomValidity('');
                }
            });
        }
        
        // Password confirmation validation
        const newPasswordInput = document.getElementById('new_password');
        const confirmPasswordInput = document.getElementById('confirm_password');
        
        if (newPasswordInput && confirmPasswordInput) {
            function validatePasswordMatch() {
                if (confirmPasswordInput.value && newPasswordInput.value !== confirmPasswordInput.value) {
                    confirmPasswordInput.setCustomValidity('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp.');
                } else {
                    confirmPasswordInput.setCustomValidity('');
                }
            }
            
            newPasswordInput.addEventListener('input', validatePasswordMatch);
            confirmPasswordInput.addEventListener('input', validatePasswordMatch);
            
            // Password strength indicator
            newPasswordInput.addEventListener('input', function() {
                updatePasswordStrength(this.value);
            });
        }
        
        // Form submission validation
        profileForm.addEventListener('submit', function(e) {
            const newPassword = newPasswordInput.value;
            const currentPassword = document.getElementById('current_password').value;
            
            // If new password is provided, current password is required
            if (newPassword && !currentPassword) {
                e.preventDefault();
                showToast('‚ùå Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i ƒë·ªÉ ƒë·ªïi m·∫≠t kh·∫©u m·ªõi.', 'error');
                return false;
            }
            
            // Validate password match
            if (newPassword && newPassword !== confirmPasswordInput.value) {
                e.preventDefault();
                showToast('‚ùå M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp.', 'error');
                return false;
            }
        });
    }
    
    // Password strength checker
    function updatePasswordStrength(password) {
        const strengthBar = document.querySelector('.password-strength-bar');
        if (!strengthBar) return;
        
        let strength = 0;
        let strengthClass = '';
        
        if (password.length >= 6) strength += 1;
        if (password.length >= 8) strength += 1;
        if (/[a-z]/.test(password)) strength += 1;
        if (/[A-Z]/.test(password)) strength += 1;
        if (/[0-9]/.test(password)) strength += 1;
        if (/[^A-Za-z0-9]/.test(password)) strength += 1;
        
        if (strength <= 2) {
            strengthClass = 'password-strength-weak';
        } else if (strength <= 3) {
            strengthClass = 'password-strength-fair';
        } else if (strength <= 4) {
            strengthClass = 'password-strength-good';
        } else {
            strengthClass = 'password-strength-strong';
        }
        
        strengthBar.className = `password-strength-bar ${strengthClass}`;
    }
});
</script>

<style>
.account-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    width: 100%;
    box-sizing: border-box;
    overflow-x: hidden;
}

.account-header {
    text-align: center;
    margin-bottom: 40px;
}

.account-header h1 {
    color: #fff;
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.account-header p {
    color: #ccc;
    font-size: 1.1rem;
}

.account-content {
    display: flex;
    flex-direction: column;
    gap: 30px;
}

.account-section {
    background: #1a1a1a;
    border-radius: 12px;
    padding: 25px;
    border: 1px solid #333;
    width: 100%;
    box-sizing: border-box;
    overflow: hidden;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #333;
}

.section-header h2 {
    color: #fff;
    font-size: 1.5rem;
    margin: 0;
}

.count-badge {
    background: #007bff;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
}

/* User Info Basic Styles */
.user-info-section {
    background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
    border: 1px solid #333;
    position: relative;
    overflow: hidden;
    width: 100%;
    box-sizing: border-box;
}

.user-info-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #007bff, #28a745, #ffc107, #dc3545);
    animation: shimmer 3s ease-in-out infinite;
}

@keyframes shimmer {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

.user-info-basic {
    display: flex;
    gap: 40px;
    align-items: flex-start;
    padding: 20px 0;
    width: 100%;
    box-sizing: border-box;
    overflow: hidden;
}

.user-avatar-container {
    flex-shrink: 0;
    position: relative;
}

.user-avatar-large {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 4px solid #007bff;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 123, 255, 0.3);
}

.user-avatar-large:hover {
    transform: scale(1.05);
    box-shadow: 0 12px 40px rgba(0, 123, 255, 0.5);
    border-color: #28a745;
}

.user-avatar-large img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: all 0.3s ease;
}

.avatar-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    border-radius: 50%;
}

.user-avatar-large:hover .avatar-overlay {
    opacity: 1;
}

.avatar-upload-icon {
    font-size: 2rem;
    color: white;
}

.user-details-grid {
    flex: 1;
    display: flex;
    gap: 20px;
    align-items: start;
    text-align: left;
    overflow: hidden;
    position: relative;
    min-width: 0;
    box-sizing: border-box;
}

.info-column {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 15px;
    min-width: 0;
    box-sizing: border-box;
}

.info-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 20px;
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    border: 2px solid #475569;
    border-radius: 12px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    text-align: left;
    justify-content: flex-start;
    width: 100%;
    box-sizing: border-box;
    min-width: 0;
}

.info-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transition: left 0.5s ease;
}

.info-item:hover::before {
    left: 100%;
}

.info-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
    border-color: #3b82f6;
}

.username-item:hover {
    border-color: #8b5cf6;
    box-shadow: 0 12px 35px rgba(139, 92, 246, 0.2);
}

.phone-item:hover {
    border-color: #06b6d4;
    box-shadow: 0 12px 35px rgba(6, 182, 212, 0.2);
}

.email-item:hover {
    border-color: #10b981;
    box-shadow: 0 12px 35px rgba(16, 185, 129, 0.2);
}

.phone-item {
    cursor: pointer;
    position: relative;
}

.phone-item:hover {
    background: rgba(0, 123, 255, 0.1);
    border-color: #007bff;
}

.info-icon {
    font-size: 1.4rem;
    min-width: 28px;
    text-align: center;
    flex-shrink: 0;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
}

.info-label {
    font-weight: 600;
    color: #cbd5e1;
    min-width: 120px;
    max-width: 140px;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    flex-shrink: 0;
    text-align: left;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.info-value {
    color: #f1f5f9;
    flex: 1;
    font-weight: 500;
    font-size: 1rem;
    text-align: left;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.edit-icon {
    font-size: 1rem;
    color: #94a3b8;
    opacity: 0.7;
    transition: all 0.3s ease;
    cursor: pointer;
    padding: 6px;
    border-radius: 6px;
    background: rgba(148, 163, 184, 0.1);
}

.phone-item:hover .edit-icon,
.username-item:hover .edit-icon {
    opacity: 1;
}

.edit-icon:hover {
    color: #3b82f6;
    background: rgba(59, 130, 246, 0.2);
    transform: scale(1.15) rotate(5deg);
}

.username-item .edit-icon:hover {
    color: #8b5cf6;
    background: rgba(139, 92, 246, 0.2);
}

.phone-item .edit-icon:hover {
    color: #06b6d4;
    background: rgba(6, 182, 212, 0.2);
}

.email-item .edit-icon:hover {
    color: #10b981;
    background: rgba(16, 185, 129, 0.2);
}

/* Edit Forms Container */
.edit-forms-container {
    margin: 20px 0;
    min-height: 0;
    transition: all 0.3s ease;
}

.edit-forms-container:empty {
    display: none;
}

/* Email edit container */
.email-edit-container {
    display: none;
    position: relative;
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    border: 2px solid #10b981;
    border-radius: 12px;
    padding: 20px;
    margin: 10px 0;
    box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
    z-index: 9999;
    overflow: hidden;
}

.email-edit-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #10b981, #3b82f6, #06b6d4);
}

.email-edit-header {
    margin-bottom: 20px;
}

.email-edit-header h4 {
    color: #f1f5f9;
    margin: 0 0 8px 0;
    font-size: 1.2rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.email-edit-description {
    color: #94a3b8;
    margin: 0;
    font-size: 0.9rem;
    line-height: 1.4;
}

.email-edit-body {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.email-edit-field {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.email-edit-label {
    color: #e2e8f0;
    font-size: 0.9rem;
    font-weight: 500;
    margin: 0;
}

.email-edit-help {
    margin-top: 5px;
}

.email-edit-help .help-text {
    color: #64748b;
    font-size: 0.8rem;
    font-style: italic;
    display: flex;
    align-items: center;
    gap: 4px;
}

.email-edit-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 10px;
}

.email-edit-actions .btn-save,
.email-edit-actions .btn-cancel {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    min-width: 120px;
    justify-content: center;
}

.email-edit-container.show {
    display: block;
    animation: slideDown 0.3s ease;
}

.email-edit-header h4 {
    color: #f1f5f9;
    margin: 0 0 15px 0;
    font-size: 1.1rem;
    font-weight: 600;
}

.email-edit-body {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.email-edit-input {
    background: #0f172a;
    border: 2px solid #475569;
    border-radius: 8px;
    padding: 12px 16px;
    color: #f1f5f9;
    font-size: 1rem;
    transition: all 0.3s ease;
    outline: none;
    width: 100%;
}

.email-edit-input:focus {
    border-color: #10b981;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    background: #1e293b;
}

.email-edit-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.email-edit-actions .btn {
    padding: 8px 16px;
    border-radius: 6px;
    font-weight: 500;
    transition: all 0.2s ease;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
}

.email-edit-actions .btn-success {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
}

.email-edit-actions .btn-success:hover {
    background: linear-gradient(135deg, #059669, #047857);
    transform: translateY(-1px);
}

.email-edit-actions .btn-secondary {
    background: linear-gradient(135deg, #6b7280, #4b5563);
    color: white;
}

.email-edit-actions .btn-secondary:hover {
    background: linear-gradient(135deg, #4b5563, #374151);
    transform: translateY(-1px);
}

.role-badge, .status-badge {
    padding: 6px 16px;
    border-radius: 25px;
    font-size: 0.9rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
}

.role-badge:hover, .status-badge:hover {
    transform: scale(1.05);
}

.role-admin {
    background: linear-gradient(135deg, #dc3545, #c82333);
    color: white;
    box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
}

.role-user {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
}

.status-badge.active {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
}

.status-badge.inactive {
    background: linear-gradient(135deg, #dc3545, #c82333);
    color: white;
    box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
}

/* Phone Edit Inline */
.phone-edit-container {
    display: none;
    position: relative;
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    border: 2px solid #06b6d4;
    border-radius: 12px;
    padding: 20px;
    margin: 10px 0;
    box-shadow: 0 8px 32px rgba(6, 182, 212, 0.3);
    z-index: 9999;
    overflow: hidden;
}

.phone-edit-container.show {
    display: block;
    animation: slideDown 0.3s ease;
}

.phone-edit-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #06b6d4, #3b82f6, #8b5cf6);
}

.phone-edit-header {
    margin-bottom: 20px;
}

.phone-edit-header h4 {
    color: #f1f5f9;
    margin: 0 0 8px 0;
    font-size: 1.2rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.phone-edit-description {
    color: #94a3b8;
    margin: 0;
    font-size: 0.9rem;
    line-height: 1.4;
}

.phone-edit-body {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.phone-edit-field {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.phone-edit-label {
    color: #e2e8f0;
    font-size: 0.9rem;
    font-weight: 500;
    margin: 0;
}

.phone-edit-input {
    width: 100%;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid #06b6d4;
    border-radius: 8px;
    color: #f1f5f9;
    font-size: 1rem;
    margin-bottom: 15px;
    transition: all 0.3s ease;
}

.phone-edit-input:focus {
    outline: none;
    border-color: #3b82f6;
    background: rgba(255, 255, 255, 0.15);
    box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.2);
}

.phone-edit-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.phone-edit-help {
    margin-top: 5px;
}

.phone-edit-help .help-text {
    color: #64748b;
    font-size: 0.8rem;
    font-style: italic;
    display: flex;
    align-items: center;
    gap: 4px;
}

.phone-edit-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 10px;
}

.phone-edit-actions .btn-save,
.phone-edit-actions .btn-cancel {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    min-width: 120px;
    justify-content: center;
}

.btn-icon {
    font-size: 0.9rem;
}

.phone-edit-actions .btn-save {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
}

.phone-edit-actions .btn-save:hover {
    background: linear-gradient(135deg, #059669, #047857);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}

.phone-edit-actions .btn-cancel {
    background: linear-gradient(135deg, #6b7280, #4b5563);
    color: white;
}

.phone-edit-actions .btn-cancel:hover {
    background: linear-gradient(135deg, #4b5563, #374151);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(107, 114, 128, 0.4);
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Username edit container */
.username-edit-container {
    display: none;
    position: relative;
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    border: 2px solid #8b5cf6;
    border-radius: 12px;
    padding: 20px;
    margin: 10px 0;
    box-shadow: 0 8px 32px rgba(139, 92, 246, 0.3);
    z-index: 9999;
    overflow: hidden;
}

.username-edit-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #8b5cf6, #3b82f6, #06b6d4);
}

.username-edit-header {
    margin-bottom: 20px;
}

.username-edit-header h4 {
    color: #f1f5f9;
    margin: 0 0 8px 0;
    font-size: 1.2rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.username-edit-description {
    color: #94a3b8;
    margin: 0;
    font-size: 0.9rem;
    line-height: 1.4;
}

.username-edit-body {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.username-edit-field {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.username-edit-label {
    color: #e2e8f0;
    font-size: 0.9rem;
    font-weight: 500;
    margin: 0;
}

.username-edit-help {
    margin-top: 5px;
}

.username-edit-help .help-text {
    color: #64748b;
    font-size: 0.8rem;
    font-style: italic;
    display: flex;
    align-items: center;
    gap: 4px;
}

.username-edit-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 10px;
}

.username-edit-actions .btn-save,
.username-edit-actions .btn-cancel {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    min-width: 120px;
    justify-content: center;
}

.username-edit-container.show {
    display: block;
    animation: slideDown 0.3s ease;
}

.username-edit-header h4 {
    color: #f1f5f9;
    margin: 0 0 15px 0;
    font-size: 1.1rem;
    font-weight: 600;
}

.username-edit-body {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.username-edit-input {
    background: #0f172a;
    border: 2px solid #475569;
    border-radius: 8px;
    padding: 12px 16px;
    color: #f1f5f9;
    font-size: 1rem;
    transition: all 0.3s ease;
    outline: none;
    width: 100%;
}

.username-edit-input:focus {
    border-color: #8b5cf6;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    background: #1e293b;
}

.username-edit-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.username-edit-actions .btn {
    padding: 8px 16px;
    border-radius: 6px;
    font-weight: 500;
    transition: all 0.2s ease;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
}

.username-edit-actions .btn-success {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
}

.username-edit-actions .btn-success:hover {
    background: linear-gradient(135deg, #059669, #047857);
    transform: translateY(-1px);
}

.username-edit-actions .btn-secondary {
    background: linear-gradient(135deg, #6b7280, #4b5563);
    color: white;
}

.username-edit-actions .btn-secondary:hover {
    background: linear-gradient(135deg, #4b5563, #374151);
    transform: translateY(-1px);
}

.phone-edit-input {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #555;
    border-radius: 6px;
    background: #1a1a1a;
    color: #fff;
    font-size: 0.9rem;
    margin-bottom: 10px;
}

.phone-edit-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
}

.btn-save, .btn-cancel {
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-save {
    background: #28a745;
    color: white;
}

.btn-save:hover {
    background: #20c997;
}

.btn-cancel {
    background: #6c757d;
    color: white;
}

.btn-cancel:hover {
    background: #5a6268;
}

.edit-form {
    margin-top: 20px;
    padding: 20px;
    background: #2a2a2a;
    border-radius: 8px;
    border: 1px solid #444;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    color: #fff;
    margin-bottom: 5px;
    font-weight: 600;
}

.form-group input {
    width: 100%;
    padding: 10px;
    border: 1px solid #555;
    border-radius: 6px;
    background: #1a1a1a;
    color: #fff;
    font-size: 1rem;
}

.form-group input:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.movie-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.movie-card {
    position: relative;
    background: #2a2a2a;
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.3s ease;
}

.movie-card:hover {
    transform: translateY(-5px);
}

.movie-card a {
    text-decoration: none;
    color: inherit;
}

.movie-poster {
    width: 100%;
    height: 280px;
    object-fit: cover;
}

.movie-info {
    padding: 15px;
}

.movie-info h3 {
    color: #fff;
    font-size: 1rem;
    margin: 0 0 8px 0;
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.movie-year, .added-date {
    color: #ccc;
    font-size: 0.9rem;
    margin: 4px 0;
}

.remove-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.7);
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    color: #fff;
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s ease;
}

.remove-btn:hover {
    background: rgba(220, 53, 69, 0.8);
}

.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: #ccc;
}

.empty-state p {
    font-size: 1.1rem;
    margin-bottom: 20px;
}


.logout-section {
    background: #2a1a1a;
    border: 1px solid #5a2a2a;
}

.logout-content {
    text-align: center;
    padding: 20px;
}

.logout-content h3 {
    color: #fff;
    margin-bottom: 10px;
    font-size: 1.3rem;
}

.logout-content p {
    color: #ccc;
    margin-bottom: 20px;
}

.btn-logout {
    background: #dc3545;
    color: white;
    padding: 12px 30px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: background 0.3s ease;
    display: inline-block;
}

.btn-logout:hover {
    background: #c82333;
    color: white;
    text-decoration: none;
}

/* Pagination Styles - T∆∞∆°ng t·ª± trang ch·ªß */
.pagination {
    margin-top: 30px;
    display: flex;
        flex-direction: column;
        align-items: center;
    gap: 20px;
}

.pagination-info {
    color: #888;
    font-size: 0.9rem;
    display: flex;
    gap: 10px;
}

.pagination-controls {
    display: flex;
    align-items: center;
    gap: 15px;
}

.btn-pagination {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #fff;
    padding: 8px 16px;
    border-radius: 6px;
    text-decoration: none;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.btn-pagination:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.4);
    transform: translateY(-1px);
    color: #fff;
    text-decoration: none;
}

.page-numbers {
    display: flex;
    gap: 5px;
    align-items: center;
}

.page-number {
    display: inline-block;
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    text-decoration: none;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    min-width: 40px;
        text-align: center;
    }
    
.page-number:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-1px);
    color: #fff;
    text-decoration: none;
}

.page-number.current {
    background: #e50914;
    color: #fff;
    font-weight: bold;
}

.page-ellipsis {
    color: #888;
    padding: 8px 4px;
    font-size: 0.9rem;
}

/* Mobile Responsive Design */
@media (max-width: 768px) {
    .user-info-basic {
        flex-direction: column;
        align-items: flex-start;
        text-align: left;
        gap: 25px;
    }
    
    .user-avatar-large {
        width: 120px;
        height: 120px;
    }
    
    .user-details-grid {
        flex-direction: column;
        gap: 15px;
        width: 100%;
    }
    
    .info-column {
        gap: 12px;
    }
    
    .info-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        padding: 15px;
        text-align: left;
        justify-content: flex-start;
    }
    
    .info-icon {
        font-size: 1.1rem;
        width: 20px;
    }
    
    .info-label {
        min-width: auto;
        font-size: 0.9rem;
        text-align: left;
    }
    
    .info-value {
        font-size: 0.95rem;
        text-align: left;
    }
    
    .role-badge, .status-badge {
        padding: 4px 12px;
        font-size: 0.8rem;
    }
    
    .phone-item {
        position: relative;
    }
    
    .phone-edit-container,
    .email-edit-container,
    .username-edit-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 400px;
        z-index: 1000;
    }
    
    .phone-edit-header h4,
    .username-edit-header h4,
    .email-edit-header h4 {
        font-size: 1.1rem;
    }
    
    .phone-edit-description,
    .username-edit-description,
    .email-edit-description {
        font-size: 0.85rem;
    }
    
    .phone-edit-actions,
    .username-edit-actions,
    .email-edit-actions {
        flex-direction: column;
        gap: 10px;
    }
    
    .phone-edit-actions .btn-save,
    .phone-edit-actions .btn-cancel,
    .username-edit-actions .btn-save,
    .username-edit-actions .btn-cancel,
    .email-edit-actions .btn-save,
    .email-edit-actions .btn-cancel {
        min-width: auto;
        width: 100%;
    }
    
    .movie-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
    }
    
    .pagination-controls {
        flex-direction: column;
        gap: 10px;
    }
    
    .page-numbers {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .btn-pagination {
        padding: 6px 12px;
        font-size: 0.8rem;
    }
    
    .page-number {
        padding: 6px 10px;
        font-size: 0.8rem;
        min-width: 35px;
    }
}

@media (max-width: 480px) {
    .account-page {
        padding: 10px;
    }
    
    .user-avatar-large {
        width: 100px;
        height: 100px;
    }
    
    .info-item {
        padding: 12px;
    }
    
    .info-icon {
        font-size: 1rem;
    }
    
    .info-label {
        font-size: 0.85rem;
    }
    
    .info-value {
        font-size: 0.9rem;
    }
    
    .role-badge, .status-badge {
        padding: 3px 10px;
        font-size: 0.75rem;
    }
}

/* Search container styles */
.search-container {
    margin: 20px 0;
    padding: 0 10px;
}

.search-form {
    position: relative;
    max-width: 500px;
    margin: 0 auto;
}

.search-input-group {
    position: relative;
    display: flex;
    align-items: center;
    background: linear-gradient(135deg, #2c3e50, #34495e);
    border-radius: 25px;
    border: 2px solid #4a5f7a;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
    overflow: hidden;
}

.search-input-group:focus-within {
    border-color: #3498db;
    box-shadow: 0 4px 20px rgba(52, 152, 219, 0.3);
    transform: translateY(-2px);
}

.search-input {
    flex: 1;
    padding: 12px 20px;
    background: transparent;
    border: none;
    color: #ecf0f1;
    font-size: 16px;
    outline: none;
    transition: all 0.3s ease;
}

.search-input::placeholder {
    color: #95a5a6;
    font-style: italic;
}

.search-input:focus::placeholder {
    color: #bdc3c7;
}

.search-btn {
    padding: 12px 16px;
    background: linear-gradient(135deg, #3498db, #2980b9);
    border: none;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 50px;
}

.search-btn:hover {
    background: linear-gradient(135deg, #2980b9, #1f618d);
    transform: scale(1.05);
}

.search-btn:active {
    transform: scale(0.95);
}

.search-icon {
    font-size: 16px;
    transition: transform 0.3s ease;
}

.search-btn:hover .search-icon {
    transform: scale(1.1);
}

.clear-search-btn {
    padding: 12px 16px;
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
    text-decoration: none;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 50px;
    border-radius: 0 25px 25px 0;
}

.clear-search-btn:hover {
    background: linear-gradient(135deg, #c0392b, #a93226);
    transform: scale(1.05);
    color: white;
    text-decoration: none;
}

.clear-search-btn:active {
    transform: scale(0.95);
}

.clear-icon {
    font-size: 16px;
    transition: transform 0.3s ease;
}

.clear-search-btn:hover .clear-icon {
    transform: scale(1.1);
}

/* Search results info */
.search-results-info {
    margin: 10px 0;
    padding: 10px 15px;
    background: linear-gradient(135deg, #27ae60, #2ecc71);
    border-radius: 8px;
    color: white;
    font-size: 14px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(39, 174, 96, 0.3);
}

.search-results-info.no-results {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    box-shadow: 0 2px 10px rgba(231, 76, 60, 0.3);
}

/* Mobile responsive for search */
@media (max-width: 768px) {
    .search-container {
        margin: 15px 0;
        padding: 0 5px;
    }
    
    .search-form {
        max-width: 100%;
    }
    
    .search-input {
        font-size: 14px;
        padding: 10px 15px;
    }
    
    .search-btn, .clear-search-btn {
        padding: 10px 12px;
        min-width: 45px;
    }
    
    .search-icon, .clear-icon {
        font-size: 14px;
    }
}

/* Loading spinner */
.loading-spinner {
    text-align: center;
    padding: 40px 20px;
    color: #3498db;
    font-size: 18px;
    font-weight: 600;
    animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}

/* Clear button styling */
.clear-search-btn {
    padding: 12px 16px;
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
    text-decoration: none;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 50px;
    border-radius: 0 25px 25px 0;
    border: none;
    cursor: pointer;
}

.clear-search-btn:hover {
    background: linear-gradient(135deg, #c0392b, #a93226);
    transform: scale(1.05);
    color: white;
    text-decoration: none;
}

.clear-search-btn:active {
    transform: scale(0.95);
}

/* Form help text */
.form-help {
    display: block;
    margin-top: 5px;
    font-size: 12px;
    color: #95a5a6;
    font-style: italic;
}

/* Form validation styles */
.form-group input:invalid {
    border-color: #e74c3c;
    box-shadow: 0 0 5px rgba(231, 76, 60, 0.3);
}

.form-group input:valid {
    border-color: #27ae60;
    box-shadow: 0 0 5px rgba(39, 174, 96, 0.3);
}

/* Password strength indicator */
.password-strength {
    margin-top: 5px;
    height: 4px;
    background: #34495e;
    border-radius: 2px;
    overflow: hidden;
}

.password-strength-bar {
    height: 100%;
    transition: all 0.3s ease;
    border-radius: 2px;
}

.password-strength-weak { background: #e74c3c; width: 25%; }
.password-strength-fair { background: #f39c12; width: 50%; }
.password-strength-good { background: #3498db; width: 75%; }
.password-strength-strong { background: #27ae60; width: 100%; }

/* Password toggle styles */
.password-input-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}

.password-input-wrapper input {
  padding-right: 50px;
  width: 100%;
}

.toggle-password {
  position: absolute;
  right: 10px;
  background: none;
  border: none;
  cursor: pointer;
  font-size: 18px;
  padding: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.2s ease;
}

.toggle-password:hover {
  transform: scale(1.1);
}

.eye-icon {
  filter: grayscale(0.3);
  transition: filter 0.2s ease;
}

.toggle-password:hover .eye-icon {
  filter: grayscale(0);
}
</style>
{% endblock %}
