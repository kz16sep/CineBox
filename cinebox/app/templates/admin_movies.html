{% extends 'base.html' %}
{% block title %}Qu·∫£n l√Ω phim ¬∑ CineBox{% endblock %}
{% block content %}
<div class="admin">
  <h1>üé¨ Qu·∫£n l√Ω phim</h1>
  
  <!-- Thanh t√¨m ki·∫øm -->
  <div class="admin-search-bar">
    <form method="GET" action="{{ url_for('main.admin_movies') }}" class="search-form">
      <div class="search-input-group">
        <input 
          type="text" 
          name="q" 
          value="{{ search_query or '' }}"
          placeholder="T√¨m ki·∫øm phim theo t√™n..." 
          class="search-input"
        />
        <button type="submit" class="search-btn">
          <span>üîç</span>
        </button>
        {% if search_query %}
        <a href="{{ url_for('main.admin_movies') }}" class="clear-search-btn">‚úï</a>
        {% endif %}
      </div>
    </form>
  </div>

  <!-- Th·ªëng k√™ -->
  <div class="admin-stats">
    <div class="stat-item">
      <span class="stat-label">T·ªïng s·ªë phim:</span>
      <span class="stat-value">{{ pagination.total if pagination else movies|length }}</span>
    </div>
    {% if search_query %}
    <div class="stat-item">
      <span class="stat-label">K·∫øt qu·∫£ t√¨m ki·∫øm:</span>
      <span class="stat-value">{{ movies|length }}</span>
    </div>
    {% endif %}
  </div>

  <!-- N√∫t th√™m phim -->
  <div class="admin-actions">
    <a class="btn btn-primary" href="{{ url_for('main.admin_movie_create') }}">
      ‚ûï Th√™m phim m·ªõi
    </a>
  </div>

  <!-- B·∫£ng phim -->
  <div class="admin-table-container">
    <table class="admin-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Poster</th>
          <th>Ti√™u ƒë·ªÅ</th>
          <th>NƒÉm</th>
          <th>L∆∞·ª£t xem</th>
          <th>Ng√†y t·∫°o</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        {% for movie in movies %}
        <tr>
          <td class="movie-id">{{ movie.movieId }}</td>
          <td class="movie-poster">
            {% if movie.posterUrl and movie.posterUrl != "1" %}
              <img src="{{ movie.posterUrl }}" alt="{{ movie.title }}" class="poster-thumb">
            {% else %}
              <div class="poster-placeholder">üìΩÔ∏è</div>
            {% endif %}
          </td>
          <td class="movie-title">{{ movie.title }}</td>
          <td class="movie-year">{{ movie.releaseYear or '-' }}</td>
          <td class="movie-views">{{ movie.viewCount or 0 }}</td>
          <td class="movie-date">{{ movie.createdAt.strftime('%d/%m/%Y') if movie.createdAt else '-' }}</td>
          <td class="movie-actions">
            <a class="btn btn-sm btn-primary" href="{{ url_for('main.admin_movie_edit', movie_id=movie.movieId) }}">
              ‚úèÔ∏è S·ª≠a
            </a>
            <form method="post" action="{{ url_for('main.admin_movie_delete', movie_id=movie.movieId) }}" 
                  style="display:inline" 
                  onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a phim \"{{ movie.title }}\"?');">
              <button class="btn btn-sm btn-delete" type="submit">üóëÔ∏è X√≥a</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7" class="no-data">
            {% if search_query %}
              Kh√¥ng t√¨m th·∫•y phim n√†o v·ªõi t·ª´ kh√≥a "{{ search_query }}"
            {% else %}
              Ch∆∞a c√≥ phim n√†o trong h·ªá th·ªëng
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Ph√¢n trang -->
  {% if pagination and pagination.pages > 1 %}
  <div class="pagination">
    <div class="pagination-info">
      Hi·ªÉn th·ªã {{ ((pagination.page - 1) * pagination.per_page + 1) }} - 
      {{ pagination.page * pagination.per_page if pagination.page * pagination.per_page < pagination.total else pagination.total }} 
      trong t·ªïng s·ªë {{ pagination.total }} phim
    </div>
    
    <div class="pagination-controls">
      {% if pagination.has_prev %}
        <a href="{{ url_for('main.admin_movies', page=pagination.prev_num, q=search_query) }}" 
           class="btn btn-secondary">‚Äπ Tr∆∞·ªõc</a>
      {% endif %}
      
      <span class="page-info">
        Trang {{ pagination.page }} / {{ pagination.pages }}
      </span>
      
      {% if pagination.has_next %}
        <a href="{{ url_for('main.admin_movies', page=pagination.next_num, q=search_query) }}" 
           class="btn btn-secondary">Ti·∫øp ‚Ä∫</a>
      {% endif %}
    </div>
  </div>
  {% endif %}
</div>

<style>
.admin {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}

.admin h1 {
  color: #fff;
  margin-bottom: 30px;
  font-size: 2.5rem;
  text-align: center;
}

.admin-search-bar {
  margin-bottom: 20px;
}

.search-form {
  max-width: 500px;
  margin: 0 auto;
}

.search-input-group {
  display: flex;
  align-items: center;
  background: var(--panel);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 8px;
  position: relative;
}

.search-input {
  flex: 1;
  background: transparent;
  border: none;
  color: #fff;
  padding: 12px 16px;
  font-size: 16px;
  outline: none;
}

.search-input::placeholder {
  color: var(--muted);
}

.search-btn {
  background: var(--primary);
  border: none;
  color: #fff;
  padding: 12px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.3s ease;
}

.search-btn:hover {
  background: var(--primary-2);
}

.clear-search-btn {
  position: absolute;
  right: 60px;
  color: var(--muted);
  text-decoration: none;
  font-size: 18px;
  padding: 8px;
  border-radius: 50%;
  transition: all 0.3s ease;
}

.clear-search-btn:hover {
  color: #fff;
  background: rgba(255, 255, 255, 0.1);
}

.admin-stats {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
  justify-content: center;
}

.stat-item {
  background: var(--panel);
  border: 1px solid rgba(255, 255, 255, 0.06);
  border-radius: 12px;
  padding: 15px 20px;
  text-align: center;
}

.stat-label {
  color: var(--muted);
  font-size: 0.9rem;
  display: block;
  margin-bottom: 5px;
}

.stat-value {
  color: var(--primary);
  font-size: 1.5rem;
  font-weight: bold;
}

.admin-actions {
  margin-bottom: 20px;
  text-align: center;
}

.admin-table-container {
  background: var(--panel);
  border: 1px solid rgba(255, 255, 255, 0.06);
  border-radius: 16px;
  overflow: hidden;
  margin-bottom: 20px;
}

.admin-table {
  width: 100%;
  border-collapse: collapse;
}

.admin-table th {
  background: var(--panel-2);
  color: #fff;
  padding: 15px 12px;
  text-align: left;
  font-weight: 600;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.admin-table td {
  padding: 12px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  color: #fff;
  vertical-align: middle;
}

.admin-table tr:hover {
  background: rgba(255, 255, 255, 0.02);
}

.movie-id {
  width: 60px;
  text-align: center;
  color: var(--muted);
}

.movie-poster {
  width: 80px;
  text-align: center;
}

.poster-thumb {
  width: 50px;
  height: 70px;
  object-fit: cover;
  border-radius: 6px;
}

.poster-placeholder {
  width: 50px;
  height: 70px;
  background: var(--panel-2);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  color: var(--muted);
}

.movie-title {
  font-weight: 600;
  max-width: 300px;
}

.movie-year, .movie-views, .movie-date {
  text-align: center;
  color: var(--muted);
}

.movie-actions {
  text-align: center;
}

.movie-actions .btn {
  margin: 0 2px;
  padding: 6px 12px;
  font-size: 12px;
}

.btn-delete {
  background: #ef4444 !important;
  color: #fff !important;
  border: 1px solid #dc2626 !important;
}

.btn-delete:hover {
  background: #dc2626 !important;
  border-color: #b91c1c !important;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.no-data {
  text-align: center;
  color: var(--muted);
  font-style: italic;
  padding: 40px !important;
}

.pagination {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 20px;
  padding: 20px;
  background: var(--panel);
  border: 1px solid rgba(255, 255, 255, 0.06);
  border-radius: 12px;
}

.pagination-info {
  color: var(--muted);
  font-size: 0.9rem;
}

.pagination-controls {
  display: flex;
  align-items: center;
  gap: 15px;
}

.page-info {
  color: #fff;
  font-weight: 600;
}

@media (max-width: 768px) {
  .admin {
    padding: 15px;
  }
  
  .admin-table-container {
    overflow-x: auto;
  }
  
  .admin-table {
    min-width: 800px;
  }
  
  .pagination {
    flex-direction: column;
    gap: 15px;
    text-align: center;
  }
  
  .admin-stats {
    flex-direction: column;
    align-items: center;
  }
}
</style>
{% endblock %}


