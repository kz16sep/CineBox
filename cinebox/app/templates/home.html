{% extends 'base.html' %}
{% block title %}{% if genre_filter %}{{ genre_filter }} ¬∑ CineBox{% else %}Trang ch·ªß ¬∑ CineBox{% endif %}{% endblock %}
{% block content %}
<section class="hero">
  <div class="hero-carousel">
    {% if carousel_movies %}
      {% for movie in carousel_movies %}
      <div class="hero-slide {{ 'active' if loop.first else '' }}" data-slide="{{ loop.index0 }}">
        <div class="hero-backdrop" style="background-image: url('{{ movie.backdrop }}')"></div>
        <div class="hero-overlay"></div>
        <div class="hero-content">
          <div class="hero-poster">
            <img src="{{ movie.poster }}" alt="{{ movie.title }}" class="poster-img" onerror="this.src='/static/img/dune2.jpg'">
          </div>
          <div class="hero-text">
            <span class="badge">{% if genre_filter %}{{ genre_filter }}{% else %}NEW{% endif %}</span>
            <h1>{{ movie.title }}</h1>
            <p class="hero-description">{{ movie.description }}</p>
            <div class="hero-actions">
              <a class="btn btn-primary" href="{{ url_for('main.watch', movie_id=movie.id) }}">
                <span class="btn-icon">‚ñ∂</span>
                Xem ngay
              </a>
              <a class="btn btn-secondary" href="{{ url_for('main.detail', movie_id=movie.id) }}">
                <span class="btn-icon">+</span>
                Th√™m v√†o danh s√°ch
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <!-- Fallback khi kh√¥ng c√≥ phim -->
      <div class="hero-slide active">
        <div class="hero-backdrop" style="background-image: url('/static/img/dune2_backdrop.jpg')"></div>
        <div class="hero-overlay"></div>
        <div class="hero-content">
          <div class="hero-poster">
            <img src="/static/img/dune2.jpg" alt="Dune 2" class="poster-img">
          </div>
          <div class="hero-text">
            <span class="badge">{% if genre_filter %}{{ genre_filter }}{% else %}NEW{% endif %}</span>
            <h1>Dune: Part Two (2024)</h1>
            <p class="hero-description">Paul Atreides unites with Chani and the Fremen while seeking revenge against the conspirators who destroyed his family.</p>
            <div class="hero-actions">
              <a class="btn btn-primary" href="#">
                <span class="btn-icon">‚ñ∂</span>
                Xem ngay
              </a>
              <a class="btn btn-secondary" href="#">
                <span class="btn-icon">+</span>
                Th√™m v√†o danh s√°ch
              </a>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
  
  <!-- Carousel Controls -->
  {% if carousel_movies and carousel_movies|length > 1 %}
  <div class="carousel-controls">
    <button class="carousel-btn prev-btn" onclick="changeSlide(-1)">‚Äπ</button>
    <div class="carousel-dots">
      {% for movie in carousel_movies %}
      <button class="dot {{ 'active' if loop.first else '' }}" onclick="currentSlide({{ loop.index }})"></button>
      {% endfor %}
    </div>
    <button class="carousel-btn next-btn" onclick="changeSlide(1)">‚Ä∫</button>
  </div>
  {% endif %}
</section>

<!-- Genre Filter Menu -->
<section class="genre-filter">
  <div class="genre-filter-container">
    <h3>üé¨ L·ªçc theo th·ªÉ lo·∫°i</h3>
    <div class="genre-buttons">
      <a href="{{ url_for('main.home') }}" 
         class="genre-btn {{ 'active' if not genre_filter else '' }}"
         data-genre="all"
         onclick="window.location.href='{{ url_for('main.home') }}'; return false;">
        üè† Trang ch·ªß
      </a>
      
      <!-- 4 th·ªÉ lo·∫°i ch√≠nh -->
      <a href="{{ url_for('main.home', genre='Action') }}" 
         class="genre-btn {{ 'active' if genre_filter == 'Action' else '' }}"
         data-genre="action">
        üé¨ Action
      </a>
      <a href="{{ url_for('main.home', genre='Adventure') }}" 
         class="genre-btn {{ 'active' if genre_filter == 'Adventure' else '' }}"
         data-genre="adventure">
        üó∫Ô∏è Adventure
      </a>
      <a href="{{ url_for('main.home', genre='Comedy') }}" 
         class="genre-btn {{ 'active' if genre_filter == 'Comedy' else '' }}"
         data-genre="comedy">
        üòÇ Comedy
      </a>
      <a href="{{ url_for('main.home', genre='Horror') }}" 
         class="genre-btn {{ 'active' if genre_filter == 'Horror' else '' }}"
         data-genre="horror">
        üëª Horror
      </a>
      
      <!-- Ch·ªâ hi·ªÉn th·ªã th·ªÉ lo·∫°i ƒë∆∞·ª£c ch·ªçn (n·∫øu kh√¥ng ph·∫£i 4 th·ªÉ lo·∫°i ch√≠nh) -->
      {% if genre_filter and genre_filter not in ['Action', 'Adventure', 'Comedy', 'Horror'] %}
        <a href="{{ url_for('main.genre_page', genre_slug=genre_filter.lower().replace(' ', '-')) }}" 
           class="genre-btn active"
           data-genre="{{ genre_filter.lower().replace(' ', '-') }}">
          {{ genre_filter }}
        </a>
      {% endif %}
    </div>
  </div>
</section>

<!-- 1. Phim m·ªõi nh·∫•t (12 phim, kh√¥ng ph√¢n trang) - ch·ªâ hi·ªÉn th·ªã khi kh√¥ng c√≥ genre filter -->
{% if not genre_filter %}
<section>
  <h3>üÜï Phim m·ªõi nh·∫•t</h3>
  <div class="cards">
    {% for m in latest_movies %}
    <div class="card">
      <a href="{{ url_for('main.detail', movie_id=m.id) }}" class="card-link">
        <div class="poster" style="background-image:url('{{ m.poster }}')"></div>
        <div class="card-content">
          <div class="card-title">{{ m.title }}</div>
          <div class="card-meta">
            {% if m.releaseYear %}<span class="year">{{ m.releaseYear }}</span>{% endif %}
            {% if m.country %}<span class="country">{{ m.country }}</span>{% endif %}
          </div>
          {% if m.genres %}<div class="card-genres">{{ m.genres }}</div>{% endif %}
          <div class="movie-rating" data-movie-id="{{ m.id }}">
            <span class="rating-stars">
              {% if m.avgRating and m.avgRating > 0 %}
                ‚≠ê {{ "%.1f"|format(m.avgRating) }}
              {% else %}
                ‚≠ê 0.0
              {% endif %}
            </span>
            <!-- rating count hidden per request -->
          </div>
        </div>
      </a>
      <div class="action-buttons">
        <button class="watchlist-btn" onclick="toggleWatchlist({{ m.id }}, event)" data-movie-id="{{ m.id }}">
          <span class="watchlist-icon">üìã</span>
        </button>
        <button class="favorite-btn" onclick="toggleFavorite({{ m.id }}, event)" data-movie-id="{{ m.id }}">
          <span class="favorite-icon">ü§ç</span>
        </button>
      </div>
    </div>
    {% endfor %}
  </div>
</section>
{% else %}
<!-- Hi·ªÉn th·ªã phim m·ªõi nh·∫•t c·ªßa th·ªÉ lo·∫°i ƒë∆∞·ª£c ch·ªçn -->
<section>
  <h3>üÜï Phim {{ genre_filter }} m·ªõi nh·∫•t</h3>
  <div class="cards">
    {% for m in latest_movies %}
    <a class="card" href="{{ url_for('main.detail', movie_id=m.id) }}">
      <div class="poster" style="background-image:url('{{ m.poster }}')"></div>
      <div class="card-title">{{ m.title }}</div>
      <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
    </a>
    {% endfor %}
  </div>
</section>
{% endif %}

<!-- 2. Cold Start Recommendations (cho user m·ªõi) -->
{% if not genre_filter and session.get('user_id') %}
<section class="cold-start-section" id="coldStartSection" style="display: none;">
  <div class="section-header">
    <h3>üåü G·ª£i √Ω d√†nh cho b·∫°n</h3>
    <div class="section-subtitle">
      <span class="badge cold-start-badge">M·ªõi</span>
      <span class="interaction-count" id="interactionCount">ƒêang ki·ªÉm tra...</span>
    </div>
  </div>
  <div class="cards" id="coldStartRecommendations">
    <!-- Cold Start recommendations s·∫Ω ƒë∆∞·ª£c load b·∫±ng JavaScript -->
  </div>
  <div class="cold-start-loading" id="coldStartLoading" style="text-align: center; padding: 20px; display: none;">
    <div class="loading-spinner">‚è≥</div>
    <p>ƒêang t·∫°o g·ª£i √Ω ph√π h·ª£p v·ªõi b·∫°n...</p>
  </div>
</section>
{% endif %}

<!-- 3. Phim ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t cho b·∫°n (Collaborative Filtering) -->
{% if not genre_filter %}
<section>
  <div class="section-header">
    <h3>üéØ G·ª£i √Ω c√° nh√¢n cho b·∫°n</h3>
    <div class="model-status" id="modelStatus" style="font-size: 0.8rem; color: #666; margin-top: 5px;">
      <span id="modelInfo">ƒêang t·∫£i th√¥ng tin model...</span>
    </div>
  </div>
  <div class="cards">
    {% for m in recommended %}
    <div class="card">
      <a href="{{ url_for('main.detail', movie_id=m.id) }}" class="card-link">
        <div class="poster" style="background-image:url('{{ m.poster }}')"></div>
        <div class="card-content">
          <div class="card-title">{{ m.title }}</div>
          <div class="card-meta">
            {% if m.releaseYear %}<span class="year">{{ m.releaseYear }}</span>{% endif %}
            {% if m.country %}<span class="country">{{ m.country }}</span>{% endif %}
          </div>
          {% if m.genres %}<div class="card-genres">{{ m.genres }}</div>{% endif %}
          <div class="recommendation-info">
            <!-- <div class="rec-score">ƒêi·ªÉm: {{ "%.3f"|format(m.score) if m.score else "N/A" }}</div> -->
            {% if m.rank %}<div class="rec-rank">#{{ m.rank }}</div>{% endif %}
              <div class="debug-info" style="font-size: 0.7rem; color: #666; margin-top: 4px; background: rgba(0,0,0,0.1); padding: 8px; border-radius: 4px;">
                <!-- <div style="font-weight: bold; color: #4CAF50; margin-bottom: 4px;">üìä Ch·ªâ s·ªë t√≠nh to√°n Score:</div> -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px;">
                  <div><strong>Score:</strong> {{ "%.3f"|format(m.score) if m.score else "N/A" }}</div>
                  <!-- <div><strong>Algorithm:</strong> {{ m.algo or "N/A" }}</div> -->
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px;">
                  <div>Ratings: {{ m.ratingCount or 0 }}</div>
                  <div>Views: {{ m.viewHistoryCount or 0 }}</div>
                  <div>Watchlist: {{ m.watchlistCount or 0 }}</div>
                  <div>Favorites: {{ m.favoriteCount or 0 }}</div>
                  <div>Comments: {{ m.commentCount or 0 }}</div>
                  <div>AvgRating: {{ "%.1f"|format(m.avgRating) if m.avgRating else "N/A" }}</div>
                </div>
                <!-- {% if m.reason %}<div style="margin-top: 4px; color: #FF9800;"><strong>üí° L√Ω do:</strong> {{ m.reason }}</div>{% endif %} -->
                {% if m.generatedAt %}<div style="margin-top: 2px; font-size: 0.6rem; color: #999;">üïí {{ m.generatedAt.strftime('%d/%m/%Y %H:%M') if m.generatedAt else 'N/A' }}</div>{% endif %}
              </div>
          </div>
          <div class="movie-rating" data-movie-id="{{ m.id }}">
            <span class="rating-stars">
              {% if m.avgRating and m.avgRating > 0 %}
                ‚≠ê {{ "%.1f"|format(m.avgRating) }}
              {% else %}
                ‚≠ê 0.0
              {% endif %}
            </span>
            <!-- rating count hidden per request -->
          </div>
        </div>
      </a>
      <div class="action-buttons">
        <button class="watchlist-btn" onclick="toggleWatchlist({{ m.id }}, event)" data-movie-id="{{ m.id }}">
          <span class="watchlist-icon">üìã</span>
        </button>
        <button class="favorite-btn" onclick="toggleFavorite({{ m.id }}, event)" data-movie-id="{{ m.id }}">
          <span class="favorite-icon">ü§ç</span>
        </button>
      </div>
    </div>
    {% endfor %}
  </div>
  {% if recommended|length == 0 %}
  <div class="empty-state">
    <div class="empty-icon">üé¨</div>
    <h4>Ch∆∞a c√≥ g·ª£i √Ω c√° nh√¢n</h4>
    <p>H√£y ƒë√°nh gi√° m·ªôt s·ªë phim ƒë·ªÉ nh·∫≠n g·ª£i √Ω c√° nh√¢n d·ª±a tr√™n s·ªü th√≠ch c·ªßa b·∫°n!</p>
    <button class="btn btn-primary" onclick="generateRecommendations()">
      T·∫°o g·ª£i √Ω ngay
    </button>
  </div>
  {% endif %}
</section>
{% endif %}

<!-- 3. Phim trending (ƒë∆∞·ª£c ƒë√°nh gi√° nhi·ªÅu nh·∫•t) -->
{% if not genre_filter and trending_movies %}
<section>
  <div class="section-header">
    <h3>üî• Phim ƒëang th·ªãnh h√†nh</h3>
    <p class="section-subtitle">Nh·ªØng b·ªô phim ƒë∆∞·ª£c ƒë√°nh gi√° nhi·ªÅu nh·∫•t</p>
  </div>
  <div class="cards">
    {% for m in trending_movies %}
    <div class="card">
      <a href="{{ url_for('main.detail', movie_id=m.id) }}" class="card-link">
        <div class="poster" style="background-image:url('{{ m.poster }}')"></div>
        <div class="card-content">
          <div class="card-title">{{ m.title }}</div>
          <div class="card-meta">
            {% if m.releaseYear %}<span class="year">{{ m.releaseYear }}</span>{% endif %}
            {% if m.country %}<span class="country">{{ m.country }}</span>{% endif %}
          </div>
          {% if m.genres %}<div class="card-genres">{{ m.genres }}</div>{% endif %}
          <div class="movie-rating" data-movie-id="{{ m.id }}">
            <span class="rating-stars">
              {% if m.avgRating and m.avgRating > 0 %}
                ‚≠ê {{ "%.1f"|format(m.avgRating) }}
              {% else %}
                ‚≠ê 0.0
              {% endif %}
            </span>
            <!-- rating count hidden per request -->
          </div>
        </div>
      </a>
      <div class="action-buttons">
        <button class="watchlist-btn" onclick="toggleWatchlist({{ m.id }}, event)" data-movie-id="{{ m.id }}">
          <span class="watchlist-icon">üìã</span>
        </button>
        <button class="favorite-btn" onclick="toggleFavorite({{ m.id }}, event)" data-movie-id="{{ m.id }}">
          <span class="favorite-icon">ü§ç</span>
        </button>
      </div>
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}

<!-- 3. T·∫•t c·∫£ phim (c√≥ ph√¢n trang) -->
{% if all_movies %}
<section class="all-movies movies-section">
  <div class="section-header">
    {% if search_query %}
      <h3>üîç K·∫øt qu·∫£ t√¨m ki·∫øm cho "{{ search_query }}"</h3>
    {% elif genre_filter %}
      <h3>üé¨ Phim {{ genre_filter }}</h3>
    {% else %}
      <h3>üé¨ T·∫•t c·∫£ phim</h3>
    {% endif %}
  </div>
  
  <div class="cards movies-grid">
    {% for m in all_movies %}
    <div class="card">
      <a href="{{ url_for('main.detail', movie_id=m.id) }}" class="card-link">
        <div class="poster" style="background-image:url('{{ m.poster }}')"></div>
        <div class="card-content">
          <div class="card-title">{{ m.title }}</div>
          <div class="card-meta">
            {% if m.releaseYear %}<span class="year">{{ m.releaseYear }}</span>{% endif %}
            {% if m.country %}<span class="country">{{ m.country }}</span>{% endif %}
          </div>
          {% if m.genres %}<div class="card-genres">{{ m.genres }}</div>{% endif %}
          <div class="movie-rating" data-movie-id="{{ m.id }}">
            <span class="rating-stars">
              {% if m.avgRating and m.avgRating > 0 %}
                ‚≠ê {{ "%.1f"|format(m.avgRating) }}
              {% else %}
                ‚≠ê 0.0
              {% endif %}
            </span>
            <span class="rating-count">
              {% if m.ratingCount and m.ratingCount > 0 %}
                ({{ m.ratingCount }})
              {% else %}
                (0)
              {% endif %}
            </span>
          </div>
        </div>
      </a>
      <div class="action-buttons">
        <button class="watchlist-btn" onclick="toggleWatchlist({{ m.id }}, event)" data-movie-id="{{ m.id }}">
          <span class="watchlist-icon">üìã</span>
        </button>
        <button class="favorite-btn" onclick="toggleFavorite({{ m.id }}, event)" data-movie-id="{{ m.id }}">
          <span class="favorite-icon">ü§ç</span>
        </button>
      </div>
    </div>
    {% endfor %}
  </div>
  
  <!-- Pagination -->
  {% if pagination and pagination.pages > 1 %}
  <div class="pagination">
    <div class="pagination-info page-info">
      <span>Trang {{ pagination.page }} / {{ pagination.pages }}</span>
      <span>({{ pagination.total }} phim)</span>
    </div>
    
    <div class="pagination-controls">
      {% if pagination.has_prev %}
        <a href="{{ url_for('main.home', page=pagination.prev_num, q=search_query, genre=genre_filter) }}" class="btn btn-pagination">
          ‚Üê Trang tr∆∞·ªõc
        </a>
      {% endif %}
      
      <div class="page-numbers">
        {% set start_page = [1, pagination.page - 2]|max %}
        {% set end_page = [pagination.pages, pagination.page + 2]|min %}
        
        {% if start_page > 1 %}
          <a href="{{ url_for('main.home', page=1, q=search_query, genre=genre_filter) }}" class="page-number">1</a>
          {% if start_page > 2 %}
            <span class="page-ellipsis">...</span>
          {% endif %}
        {% endif %}
        
        {% for page_num in range(start_page, end_page + 1) %}
          {% if page_num == pagination.page %}
            <span class="page-number current">{{ page_num }}</span>
          {% else %}
            <a href="{{ url_for('main.home', page=page_num, q=search_query, genre=genre_filter) }}" class="page-number">{{ page_num }}</a>
          {% endif %}
        {% endfor %}
        
        {% if end_page < pagination.pages %}
          {% if end_page < pagination.pages - 1 %}
            <span class="page-ellipsis">...</span>
          {% endif %}
          <a href="{{ url_for('main.home', page=pagination.pages, q=search_query, genre=genre_filter) }}" class="page-number">{{ pagination.pages }}</a>
        {% endif %}
      </div>
      
      {% if pagination.has_next %}
        <a href="{{ url_for('main.home', page=pagination.next_num, q=search_query, genre=genre_filter) }}" class="btn btn-pagination">
          Trang sau ‚Üí
        </a>
      {% endif %}
    </div>
  </div>
  {% endif %}
</section>
{% endif %}

<style>
/* CSS Variables */
:root {
  --primary: #3b82f6;
  --primary-2: #8b5cf6;
  --panel: rgba(255, 255, 255, 0.05);
  --text-primary: #fff;
  --text-secondary: #ccc;
  --text-muted: #888;
  --border: rgba(255, 255, 255, 0.1);
  --shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

/* Hero Section */
.hero {
  position: relative;
  min-height: 65vh;
  margin-bottom: 30px;
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
}

.hero-carousel {
  position: relative;
  width: 100%;
  height: 100%;
}

.hero-slide {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  transition: opacity 1s ease-in-out;
}

.hero-slide.active {
  opacity: 1;
}

.hero-backdrop {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  filter: blur(3px);
  transform: scale(1.1);
}

.hero-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.4));
  z-index: 1;
}

.hero-content {
  position: relative;
  z-index: 2;
  display: flex;
  align-items: center;
  min-height: 65vh;
  padding: 30px;
  max-width: 1000px;
  margin: 0 auto;
  gap: 30px;
}

.hero-poster {
  flex-shrink: 0;
  width: 220px;
  height: 330px;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.1);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
}

.hero-poster::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, rgba(255, 107, 107, 0.1), rgba(255, 255, 255, 0.05));
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 1;
}

.hero-poster:hover {
  transform: scale(1.08) translateY(-5px);
  box-shadow: 0 30px 70px rgba(0, 0, 0, 0.8), 0 0 0 2px rgba(255, 107, 107, 0.3);
}

.hero-poster:hover::before {
  opacity: 1;
}

.poster-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  z-index: 2;
}

.hero-poster:hover .poster-img {
  transform: scale(1.05);
}

.hero-text {
  flex: 1;
  color: white;
}

.badge {
  display: inline-block;
  background: linear-gradient(135deg, #ff6b6b, #ee5a24);
  color: white;
  padding: 10px 20px;
  border-radius: 30px;
  font-size: 0.95rem;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin-bottom: 25px;
  box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
  position: relative;
  overflow: hidden;
}

.badge::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

.badge:hover::before {
  left: 100%;
}

.hero-text h1 {
  font-size: 2.8rem;
  font-weight: 800;
  margin: 0 0 15px 0;
  line-height: 1.1;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  background: linear-gradient(135deg, #fff, #e0e0e0);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero-description {
  font-size: 1.1rem;
  line-height: 1.5;
  margin: 0 0 25px 0;
  color: rgba(255, 255, 255, 0.9);
  max-width: 500px;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

.hero-actions {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 60px; /* Add space to prevent overlap with carousel controls */
}

.hero-actions .btn {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 18px 35px;
  font-size: 1.15rem;
  font-weight: 700;
  border-radius: 50px;
  text-decoration: none;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
  position: relative;
  overflow: hidden;
}

.hero-actions .btn-primary {
  background: linear-gradient(135deg, #ff6b6b, #ee5a24);
  color: white;
  border: none;
}

.hero-actions .btn-primary:hover {
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 15px 40px rgba(255, 107, 107, 0.5);
  background: linear-gradient(135deg, #ff7b7b, #ff6b24);
}

.hero-actions .btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 2px solid rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(10px);
}

.hero-actions .btn-secondary:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.6);
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 15px 40px rgba(255, 255, 255, 0.2);
}

.btn-icon {
  font-size: 1.2rem;
}

/* Carousel Controls */
.carousel-controls {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 40px;
  z-index: 10;
}

.carousel-btn {
  background: rgba(255, 255, 255, 0.2);
  border: 2px solid rgba(255, 255, 255, 0.3);
  color: white;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  font-size: 1.5rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
}

.carousel-btn:hover {
  background: rgba(255, 255, 255, 0.3);
  border-color: rgba(255, 255, 255, 0.5);
  transform: scale(1.1);
}

.carousel-dots {
  display: flex;
  gap: 8px;
}

.dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: none;
  background: rgba(255, 255, 255, 0.4);
  cursor: pointer;
  transition: all 0.3s ease;
}

.dot.active {
  background: #ff6b6b;
  transform: scale(1.2);
}

.dot:hover {
  background: rgba(255, 255, 255, 0.7);
}

/* Responsive Design */
@media (max-width: 768px) {
  .hero-content {
    flex-direction: column;
    text-align: center;
    padding: 20px;
    gap: 20px;
  }
  
  .hero-poster {
    width: 180px;
    height: 270px;
  }
  
  .hero-text h1 {
    font-size: 2.5rem;
  }
  
  .hero-description {
    font-size: 1rem;
  }
  
  .hero-actions {
    justify-content: center;
  }
  
  .carousel-controls {
    bottom: 10px;
    gap: 30px;
  }
  
  .carousel-btn {
    width: 35px;
    height: 35px;
    font-size: 1.2rem;
  }
  
  .dot {
    width: 10px;
    height: 10px;
  }
}

/* Genre Filter Section */
.genre-filter {
  margin: 20px 0 40px 0;
  padding: 20px 0;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
  border-radius: 15px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.genre-filter-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.genre-filter h3 {
  color: #fff;
  font-size: 1.3rem;
  margin: 0 0 20px 0;
  text-align: center;
  font-weight: 600;
}

.genre-buttons {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
}

.genre-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  text-decoration: none;
  border-radius: 25px;
  font-weight: 500;
  font-size: 0.95rem;
  transition: all 0.3s ease;
  border: 2px solid transparent;
  backdrop-filter: blur(10px);
}

.genre-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  color: #fff;
  text-decoration: none;
}

.genre-btn.active {
  background: linear-gradient(135deg, #ff6b35, #f7931e);
  border-color: #ff6b35;
  box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
  color: #fff;
  font-weight: 600;
}

.genre-btn.active:hover {
  background: linear-gradient(135deg, #ff7b45, #ffa31e);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(255, 107, 53, 0.5);
}

/* Responsive */
@media (max-width: 768px) {
  .genre-buttons {
    gap: 8px;
  }
  
  .genre-btn {
    padding: 10px 16px;
    font-size: 0.9rem;
  }
  
  .genre-filter h3 {
    font-size: 1.1rem;
  }
}

/* All Movies Section */
.all-movies {
  margin: 40px 0;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.section-header h3 {
  color: #fff;
  font-size: 1.5rem;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 8px;
}

.section-actions {
  display: flex;
  gap: 10px;
  align-items: center;
}

.section-subtitle {
  color: #888;
  font-size: 0.9rem;
  margin: 5px 0 0 0;
}

.card-content {
  padding: 15px;
}

.card-meta {
  display: flex;
  gap: 10px;
  margin: 8px 0;
  font-size: 0.85rem;
  color: #888;
}

.card-meta .year {
  background: #333;
  padding: 2px 6px;
  border-radius: 4px;
  color: #fff;
}

.card-meta .country {
  color: #888;
}

.card-genres {
  font-size: 0.8rem;
  color: #aaa;
  margin: 8px 0;
  line-height: 1.3;
}

.recommendation-info {
  display: flex;
  gap: 15px;
  margin: 10px 0;
  font-size: 0.85rem;
}

.recommendation-status {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-right: 15px;
}

.status-indicator {
  font-size: 0.9rem;
  padding: 4px 8px;
  border-radius: 12px;
  background: #2c3e50;
  color: white;
  font-weight: 500;
}

.status-text {
  font-size: 0.8rem;
  color: #666;
  font-style: italic;
}

.rec-score {
  color: #4CAF50;
  font-weight: 600;
}

.rec-rank {
  color: #2196F3;
  font-weight: 600;
}

.trending-info {
  display: flex;
  gap: 15px;
  margin: 10px 0;
  font-size: 0.85rem;
}

.rating-count {
  color: #888;
}

.avg-rating {
  color: #FFD700;
  font-weight: 600;
}

.empty-state {
  text-align: center;
  padding: 40px 20px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 12px;
  margin: 20px 0;
}

.empty-icon {
  font-size: 3rem;
  margin-bottom: 15px;
}

.empty-state h4 {
  color: #fff;
  margin: 0 0 10px 0;
  font-size: 1.2rem;
}

.empty-state p {
  color: #888;
  margin: 0 0 20px 0;
  line-height: 1.5;
}

.section-info {
  color: #888;
  font-size: 0.9rem;
}

.movie-count {
  background: rgba(255, 255, 255, 0.1);
  padding: 4px 12px;
  border-radius: 12px;
  backdrop-filter: blur(10px);
}

.card-content {
  padding: 12px;
}

.card-meta {
  margin: 5px 0;
  font-size: 0.8rem;
}

.upload-time {
  color: #4CAF50;
  font-weight: bold;
  background: rgba(76, 175, 80, 0.1);
  padding: 2px 8px;
  border-radius: 8px;
}

.movie-rating {
  display: flex;
  align-items: center;
  gap: 5px;
  margin-top: 5px;
  font-size: 0.9rem;
}

.rating-stars {
  color: #ffc107;
  font-weight: bold;
}

.rating-count {
  color: #ccc;
  font-size: 0.8rem;
}

/* Pagination Styles */
.pagination {
  margin-top: 30px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.pagination-info {
  color: #888;
  font-size: 0.9rem;
  display: flex;
  gap: 10px;
}

.pagination-controls {
  display: flex;
  align-items: center;
  gap: 15px;
}

.btn-pagination {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: #fff;
  padding: 8px 16px;
  border-radius: 6px;
  text-decoration: none;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.btn-pagination:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.4);
  transform: translateY(-1px);
}

.page-numbers {
  display: flex;
  gap: 5px;
  align-items: center;
}

.page-number {
  display: inline-block;
  padding: 8px 12px;
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  text-decoration: none;
  border-radius: 6px;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  min-width: 40px;
  text-align: center;
}

.page-number:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-1px);
}

.page-number.current {
  background: #e50914;
  color: #fff;
  font-weight: bold;
}

.page-ellipsis {
  color: #888;
  padding: 8px 4px;
  font-size: 0.9rem;
}

/* Responsive */
@media (max-width: 768px) {
  .section-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .pagination-controls {
    flex-direction: column;
    gap: 10px;
  }
  
  .page-numbers {
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .btn-pagination {
    padding: 6px 12px;
    font-size: 0.8rem;
  }
  
  .page-number {
    padding: 6px 10px;
    font-size: 0.8rem;
    min-width: 35px;
  }
}

/* AJAX Loading States */
.movies-grid {
  transition: opacity 0.3s ease;
}

.movies-grid.loading {
  opacity: 0.7;
}

.genre-btn {
  transition: all 0.3s ease;
}

.genre-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.page-number {
  transition: all 0.3s ease;
}

.page-number:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* Smooth scrolling */
html {
  scroll-behavior: smooth;
}

/* Card Styles */
.card {
  position: relative;
  background: var(--panel);
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.3s ease;
  border: 1px solid var(--border);
  backdrop-filter: blur(10px);
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  border-color: var(--primary);
}

.action-buttons {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 8px;
  z-index: 10;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.card:hover .action-buttons {
  opacity: 1;
}

.favorite-btn, .watchlist-btn {
  background: rgba(0, 0, 0, 0.8);
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow);
}

.favorite-btn:hover, .watchlist-btn:hover {
  background: rgba(0, 0, 0, 0.9);
  transform: scale(1.1);
}

.favorite-btn.favorited {
  background: linear-gradient(135deg, #ff6b6b, #ee5a24);
  box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
}

.favorite-btn.favorited:hover {
  background: linear-gradient(135deg, #ff7b7b, #ff6b24);
  transform: scale(1.15);
  box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5);
}

.watchlist-btn.watchlisted {
  background: linear-gradient(135deg, #4CAF50, #45a049);
  box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
}

.watchlist-btn.watchlisted:hover {
  background: linear-gradient(135deg, #5cbf60, #4CAF50);
  transform: scale(1.15);
  box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
}

.favorite-icon, .watchlist-icon {
  font-size: 18px;
  transition: all 0.3s ease;
}

.card-link {
  text-decoration: none;
  color: inherit;
  display: block;
  width: 100%;
  height: 100%;
}

.card-link:hover {
  text-decoration: none;
  color: inherit;
}

.poster {
  width: 100%;
  height: 280px;
  background-size: cover;
  background-position: center;
  border-radius: 8px;
  margin-bottom: 10px;
  transition: transform 0.3s ease;
}

.card:hover .poster {
  transform: scale(1.05);
}

.card-title {
  color: var(--text-primary);
  font-weight: bold;
  margin-bottom: 5px;
  font-size: 0.9em;
  line-height: 1.3;
  padding: 0 10px;
}

.card-content {
  padding: 12px;
}

.card-meta {
  margin: 5px 0;
  font-size: 0.8rem;
  padding: 0 10px;
}

.upload-time {
  color: #4CAF50;
  font-weight: bold;
  background: rgba(76, 175, 80, 0.1);
  padding: 2px 8px;
  border-radius: 8px;
  font-size: 0.75rem;
}

/* Cards Grid Layout */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

.movies-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 20px;
  margin: 20px 0;
}

/* Responsive Grid */
@media (max-width: 768px) {
  .cards, .movies-grid {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
  }
}

@media (max-width: 480px) {
  .cards, .movies-grid {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 10px;
  }
}

/* Cold Start Section Styles */
.cold-start-section {
  background: linear-gradient(135deg, rgba(78, 205, 196, 0.1) 0%, rgba(255, 107, 107, 0.1) 100%);
  border: 1px solid rgba(78, 205, 196, 0.3);
  border-radius: 15px;
  padding: 30px;
  margin-bottom: 40px;
}

.section-subtitle {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-top: 10px;
}

.cold-start-badge {
  background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
  color: white;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.interaction-count {
  color: #4ecdc4;
  font-size: 0.9rem;
  font-weight: 500;
}

.recommendation-info {
  margin: 10px 0;
  padding: 8px 12px;
  background: rgba(78, 205, 196, 0.1);
  border-radius: 8px;
  border-left: 3px solid #4ecdc4;
}

.rec-score {
  font-weight: bold;
  color: #4ecdc4;
  font-size: 0.9rem;
}

.rec-rank {
  font-weight: bold;
  color: #ff6b6b;
  font-size: 0.8rem;
}

.debug-info {
  margin-top: 6px;
  padding-top: 6px;
  border-top: 1px solid rgba(78, 205, 196, 0.3);
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2px;
}

.debug-info div {
  font-size: 0.7rem;
  color: #666;
}

.rec-badge {
  display: inline-block;
  background: #4ecdc4;
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 0.7rem;
  font-weight: 600;
  margin-bottom: 5px;
}

.rec-reason {
  font-size: 0.8rem;
  color: #b0b0b0;
  font-style: italic;
}

.cold-start-loading {
  text-align: center;
  padding: 40px;
  color: #4ecdc4;
}

.loading-spinner {
  font-size: 2rem;
  animation: spin 1s linear infinite;
  margin-bottom: 15px;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Responsive design for cold start */
@media (max-width: 768px) {
  .cold-start-section {
    padding: 20px;
    margin-bottom: 30px;
  }
  
  .section-subtitle {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }
  
  .recommendation-info {
    padding: 6px 10px;
  }
}
</style>

<script>
// AJAX Pagination, Genre Filter, and Search
document.addEventListener('DOMContentLoaded', function() {
    // Attach pagination listeners
    attachPaginationListeners();
    
    // Attach genre filter listeners
    attachGenreFilterListeners();
    
    // Attach search listeners
    attachSearchListeners();
    
    // Check favorite and watchlist status for all movies on page load
    checkAllFavoriteStatus();
    checkAllWatchlistStatus();
    
    // Load ratings for all movies
    // loadAllRatings(); // disabled for consistent server-rendered ratings
});

function attachGenreFilterListeners() {
    const genreLinks = document.querySelectorAll('.genre-btn');
    
    genreLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            const genre = this.getAttribute('data-genre');
            
            // N·∫øu l√† "T·∫•t c·∫£" th√¨ d√πng AJAX, c√°c th·ªÉ lo·∫°i kh√°c th√¨ chuy·ªÉn trang
            if (genre === 'all') {
                e.preventDefault();
                
                const url = this.href;
                
                // Show loading indicator
                showLoading();
                
                // Add loading class to movies grid
                const moviesGrid = document.querySelector('.movies-grid');
                if (moviesGrid) {
                    moviesGrid.classList.add('loading');
                }
                
                // Fetch new page content
                fetch(url)
                .then(response => response.text())
                .then(html => {
                    // Parse the response
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Update the movies grid
                    const newMoviesGrid = doc.querySelector('.movies-grid');
                    const currentMoviesGrid = document.querySelector('.movies-grid');
                    if (newMoviesGrid && currentMoviesGrid) {
                        currentMoviesGrid.innerHTML = newMoviesGrid.innerHTML;
                        // Check favorite and watchlist status for new movies
                        checkAllFavoriteStatus();
                        checkAllWatchlistStatus();
                        // loadAllRatings(); // disabled
                    }
                    
                    // Update pagination
                    const newPagination = doc.querySelector('.pagination-controls');
                    const currentPagination = document.querySelector('.pagination-controls');
                    if (newPagination && currentPagination) {
                        currentPagination.innerHTML = newPagination.innerHTML;
                        // Re-attach event listeners to new pagination links
                        attachPaginationListeners();
                    }
                    
                    // Update page info
                    const newPageInfo = doc.querySelector('.page-info');
                    const currentPageInfo = document.querySelector('.page-info');
                    if (newPageInfo && currentPageInfo) {
                        currentPageInfo.innerHTML = newPageInfo.innerHTML;
                    }
                    
                    // Update genre filter active state
                    const newGenreFilter = doc.querySelector('.genre-filter');
                    const currentGenreFilter = document.querySelector('.genre-filter');
                    if (newGenreFilter && currentGenreFilter) {
                        currentGenreFilter.innerHTML = newGenreFilter.innerHTML;
                        // Re-attach event listeners to new genre links
                        attachGenreFilterListeners();
                    }
                    
                    // Update section title
                    const newSectionTitle = doc.querySelector('.movies-section h3');
                    const currentSectionTitle = document.querySelector('.movies-section h3');
                    if (newSectionTitle && currentSectionTitle) {
                        currentSectionTitle.innerHTML = newSectionTitle.innerHTML;
                    }
                    
                    // Update section info
                    const newSectionInfo = doc.querySelector('.section-info');
                    const currentSectionInfo = document.querySelector('.section-info');
                    if (newSectionInfo && currentSectionInfo) {
                        currentSectionInfo.innerHTML = newSectionInfo.innerHTML;
                    }
                    
                    // Scroll to top of movies section
                    const moviesSection = document.querySelector('.movies-section');
                    if (moviesSection) {
                        moviesSection.scrollIntoView({ behavior: 'smooth' });
                    }
                    
                    // Update URL without reload
                    window.history.pushState({}, '', url);
                    
                    // Remove loading class
                    const moviesGrid = document.querySelector('.movies-grid');
                    if (moviesGrid) {
                        moviesGrid.classList.remove('loading');
                    }
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error loading page:', error);
                    
                    // Remove loading class
                    const moviesGrid = document.querySelector('.movies-grid');
                    if (moviesGrid) {
                        moviesGrid.classList.remove('loading');
                    }
                    
                    hideLoading();
                    // Fallback to normal page reload
                    window.location.href = url;
                });
            } else {
                // C√°c th·ªÉ lo·∫°i kh√°c: chuy·ªÉn trang b√¨nh th∆∞·ªùng
                // Kh√¥ng preventDefault, ƒë·ªÉ link ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng
            }
        });
    });
}

function attachPaginationListeners() {
    const paginationLinks = document.querySelectorAll('.pagination-controls a');
    
    paginationLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            const url = this.href;
            
            // Show loading indicator
            showLoading();
            
            // Add loading class to movies grid
            const moviesGrid = document.querySelector('.movies-grid');
            if (moviesGrid) {
                moviesGrid.classList.add('loading');
            }
            
            // Fetch new page content
            fetch(url)
                .then(response => response.text())
                .then(html => {
                    // Parse the response
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Update the movies grid
                    const newMoviesGrid = doc.querySelector('.movies-grid');
                    const currentMoviesGrid = document.querySelector('.movies-grid');
                    if (newMoviesGrid && currentMoviesGrid) {
                        currentMoviesGrid.innerHTML = newMoviesGrid.innerHTML;
                        // Check favorite and watchlist status for new movies
                        checkAllFavoriteStatus();
                        checkAllWatchlistStatus();
                        // loadAllRatings(); // disabled
                    }
                    
                    // Update pagination
                    const newPagination = doc.querySelector('.pagination-controls');
                    const currentPagination = document.querySelector('.pagination-controls');
                    if (newPagination && currentPagination) {
                        currentPagination.innerHTML = newPagination.innerHTML;
                        // Re-attach event listeners to new pagination links
                        attachPaginationListeners();
                    }
                    
                    // Update page info
                    const newPageInfo = doc.querySelector('.page-info');
                    const currentPageInfo = document.querySelector('.page-info');
                    if (newPageInfo && currentPageInfo) {
                        currentPageInfo.innerHTML = newPageInfo.innerHTML;
                    }
                    
                    // Scroll to top of movies section
                    const moviesSection = document.querySelector('.movies-section');
                    if (moviesSection) {
                        moviesSection.scrollIntoView({ behavior: 'smooth' });
                    }
                    
                    // Update URL without reload
                    window.history.pushState({}, '', url);
                    
                    // Remove loading class
                    const moviesGrid = document.querySelector('.movies-grid');
                    if (moviesGrid) {
                        moviesGrid.classList.remove('loading');
                    }
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error loading page:', error);
                    
                    // Remove loading class
                    const moviesGrid = document.querySelector('.movies-grid');
                    if (moviesGrid) {
                        moviesGrid.classList.remove('loading');
                    }
                    
                    hideLoading();
                    // Fallback to normal page reload
                    window.location.href = url;
                });
        });
    });
}

function showLoading() {
    // Create loading overlay
    let loadingOverlay = document.getElementById('loading-overlay');
    if (!loadingOverlay) {
        loadingOverlay = document.createElement('div');
        loadingOverlay.id = 'loading-overlay';
        loadingOverlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        `;
        
        const loadingSpinner = document.createElement('div');
        loadingSpinner.style.cssText = `
            width: 50px;
            height: 50px;
            border: 5px solid #333;
            border-top: 5px solid #e50914;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        `;
        
        loadingOverlay.appendChild(loadingSpinner);
        document.body.appendChild(loadingOverlay);
        
        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    }
    loadingOverlay.style.display = 'flex';
}

function hideLoading() {
    const loadingOverlay = document.getElementById('loading-overlay');
    if (loadingOverlay) {
        loadingOverlay.style.display = 'none';
    }
}

function attachSearchListeners() {
    const searchInput = document.getElementById('headerSearchInput');
    const searchForm = document.querySelector('.search');
    
    if (searchForm) {
        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const query = searchInput.value.trim();
            if (query.length < 2) {
                return;
            }
            
            // Redirect to search page with query
            const url = new URL(window.location.origin + '/search');
            url.searchParams.set('q', query);
            window.location.href = url.toString();
        });
    }
}

// Favorite functionality
function toggleFavorite(movieId, event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    fetch(`/toggle-favorite/${movieId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateFavoriteButton(movieId, data.is_favorite);
            showToast(data.message, 'success');
        } else {
            showToast(data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('C√≥ l·ªói x·∫£y ra khi chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i y√™u th√≠ch', 'error');
    });
}

// Watchlist functionality
function toggleWatchlist(movieId, event) {
    if (event) {
        event.preventDefault();
        event.stopPropagation();
    }
    
    fetch(`/toggle-watchlist/${movieId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateWatchlistButton(movieId, data.is_watchlist);
            showToast(data.message, 'success');
        } else {
            showToast(data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('C√≥ l·ªói x·∫£y ra khi chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i xem sau', 'error');
    });
}

function updateFavoriteButton(movieId, isFavorite) {
    const favoriteBtn = document.querySelector(`.favorite-btn[data-movie-id="${movieId}"]`);
    const favoriteIcon = favoriteBtn.querySelector('.favorite-icon');
    
    if (isFavorite) {
        favoriteIcon.textContent = '‚ù§Ô∏è';
        favoriteBtn.classList.add('favorited');
    } else {
        favoriteIcon.textContent = 'ü§ç';
        favoriteBtn.classList.remove('favorited');
    }
}

function updateWatchlistButton(movieId, isWatchlist) {
    const watchlistBtn = document.querySelector(`.watchlist-btn[data-movie-id="${movieId}"]`);
    const watchlistIcon = watchlistBtn.querySelector('.watchlist-icon');
    
    if (isWatchlist) {
        watchlistIcon.textContent = '‚úÖ';
        watchlistBtn.classList.add('watchlisted');
    } else {
        watchlistIcon.textContent = 'üìã';
        watchlistBtn.classList.remove('watchlisted');
    }
}

function checkFavoriteStatus(movieId) {
    fetch(`/check-favorite/${movieId}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateFavoriteButton(movieId, data.is_favorite);
        }
    })
    .catch(error => {
        console.error('Error checking favorite status:', error);
    });
}

function checkWatchlistStatus(movieId) {
    fetch(`/check-watchlist/${movieId}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateWatchlistButton(movieId, data.is_watchlist);
        }
    })
    .catch(error => {
        console.error('Error checking watchlist status:', error);
    });
}

function checkAllFavoriteStatus() {
    const favoriteBtns = document.querySelectorAll('.favorite-btn');
    favoriteBtns.forEach(btn => {
        const movieId = btn.getAttribute('data-movie-id');
        if (movieId) {
            checkFavoriteStatus(parseInt(movieId));
        }
    });
}

function checkAllWatchlistStatus() {
    const watchlistBtns = document.querySelectorAll('.watchlist-btn');
    watchlistBtns.forEach(btn => {
        const movieId = btn.getAttribute('data-movie-id');
        if (movieId) {
            checkWatchlistStatus(parseInt(movieId));
        }
    });
}

function showToast(message, type = 'success') {
    // Create toast if it doesn't exist
    let toast = document.getElementById('toast');
    if (!toast) {
        toast = document.createElement('div');
        toast.id = 'toast';
        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2d3748;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease-in-out;
            max-width: 300px;
            border-left: 4px solid #48bb78;
        `;
        document.body.appendChild(toast);
    }
    
    // Update toast content and style
    toast.innerHTML = `<div class="toast-content">${message}</div>`;
    toast.className = `toast ${type}`;
    if (type === 'error') {
        toast.style.borderLeftColor = '#f56565';
    } else {
        toast.style.borderLeftColor = '#48bb78';
    }
    
    // Show toast
    toast.style.transform = 'translateX(0)';
    
    // Auto hide after 3 seconds
    setTimeout(() => {
        toast.style.transform = 'translateX(400px)';
    }, 3000);
}

// Carousel functionality
let currentSlideIndex = 0;
let slideInterval;
const slides = document.querySelectorAll('.hero-slide');
const dots = document.querySelectorAll('.dot');
const totalSlides = slides.length;

function showSlide(index) {
    // Remove active class from all slides and dots
    slides.forEach(slide => slide.classList.remove('active'));
    dots.forEach(dot => dot.classList.remove('active'));
    
    // Add active class to current slide and dot
    if (slides[index]) {
        slides[index].classList.add('active');
    }
    if (dots[index]) {
        dots[index].classList.add('active');
    }
    
    currentSlideIndex = index;
}

function nextSlide() {
    const nextIndex = (currentSlideIndex + 1) % totalSlides;
    showSlide(nextIndex);
}

function prevSlide() {
    const prevIndex = (currentSlideIndex - 1 + totalSlides) % totalSlides;
    showSlide(prevIndex);
}

function changeSlide(direction) {
    clearInterval(slideInterval);
    if (direction === 1) {
        nextSlide();
    } else {
        prevSlide();
    }
    // Reset timer - ƒë·∫øm l·∫°i t·ª´ ƒë·∫ßu
    setTimeout(startAutoSlide, 100);
}

function currentSlide(index) {
    clearInterval(slideInterval);
    showSlide(index - 1);
    // Reset timer - ƒë·∫øm l·∫°i t·ª´ ƒë·∫ßu
    setTimeout(startAutoSlide, 100);
}

function startAutoSlide() {
    slideInterval = setInterval(nextSlide, 7000); // 7 seconds
}

function stopAutoSlide() {
    clearInterval(slideInterval);
}

// Initialize carousel
document.addEventListener('DOMContentLoaded', function() {
    if (totalSlides > 0) {
        showSlide(0);
        startAutoSlide();
        
        // Pause on hover
        const hero = document.querySelector('.hero');
        if (hero) {
            hero.addEventListener('mouseenter', stopAutoSlide);
            hero.addEventListener('mouseleave', startAutoSlide);
        }
    }
});

// Rating functions
function loadAllRatings() {
  const ratingElements = document.querySelectorAll('.movie-rating[data-movie-id]');
  ratingElements.forEach(element => {
    const movieId = element.dataset.movieId;
    loadMovieRating(movieId, element);
  });
}

function loadMovieRating(movieId, element) {
  fetch(`/get-rating/${movieId}`)
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      const ratingStars = element.querySelector('.rating-stars');
      const ratingCount = element.querySelector('.rating-count');
      const normalizedAvg = (data.avgRating ?? data.avg_rating ?? 0);
      const normalizedCount = (data.ratingCount ?? data.total_ratings ?? 0);
      
      ratingStars.textContent = `‚≠ê ${normalizedAvg}`;
      ratingCount.textContent = `(${normalizedCount})`;
    }
  })
  .catch(error => {
    console.error('Error loading rating for movie', movieId, ':', error);
  });
}

// generateRecommendations removed per request

// Show notification function
function showNotification(message, type = 'info') {
  // Create notification element
  const notification = document.createElement('div');
  notification.className = `notification notification-${type}`;
  notification.innerHTML = `
    <div class="notification-content">
      <span class="notification-icon">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
      <span class="notification-message">${message}</span>
    </div>
  `;
  
  // Add styles
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
    color: white;
    padding: 15px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 10000;
    max-width: 400px;
    animation: slideIn 0.3s ease-out;
  `;
  
  // Add animation styles
  if (!document.getElementById('notification-styles')) {
    const style = document.createElement('style');
    style.id = 'notification-styles';
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
      .notification-content {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .notification-icon {
        font-size: 18px;
      }
      .notification-message {
        font-size: 14px;
        font-weight: 500;
      }
    `;
    document.head.appendChild(style);
  }
  
  // Add to page
  document.body.appendChild(notification);
  
  // Remove after 3 seconds
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease-in';
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 300);
  }, 3000);
}

// Enhanced showToast function (alias for showNotification)
function showToast(message, type = 'success') {
  showNotification(message, type);
}

// Personalized Recommendations Functions
function loadPersonalizedRecommendations() {
  fetch('/api/personalized_recommendations')
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        updateRecommendationsDisplay(data.recommendations);
      } else {
        // Show user rating count even when no recommendations
        if (data.userRatingCount !== undefined) {
          showUserRatingCount(data.userRatingCount);
        }
      }
    })
    .catch(error => {
      console.error('Error loading personalized recommendations:', error);
    })
    ;
}

function showUserRatingCount(userRatingCount) {
  const container = document.getElementById('personalizedRecommendations');
  if (!container) return;
  
  container.innerHTML = `
    <div class="no-recommendations" style="text-align: center; padding: 40px; color: #888;">
      <h4>Ch∆∞a c√≥ g·ª£i √Ω c√° nh√¢n h√≥a</h4>
      <p>B·∫°n ƒë√£ ƒë√°nh gi√° <strong>${userRatingCount}</strong> phim</p>
      <p>H√£y ƒë√°nh gi√° th√™m phim ƒë·ªÉ c√≥ g·ª£i √Ω t·ªët h∆°n!</p>
    </div>
  `;
}

function updateRecommendationsDisplay(recommendations) {
  const container = document.getElementById('personalizedRecommendations');
  if (!container) return;
  
  container.innerHTML = recommendations.map(rec => `
    <div class="card">
      <a href="/detail/${rec.movieId}" class="card-link">
        <div class="poster" style="background-image:url('${rec.poster}')"></div>
        <div class="card-content">
          <div class="card-title">${rec.title}</div>
          <div class="card-meta">
            ${rec.releaseYear ? `<span class="year">${rec.releaseYear}</span>` : ''}
            ${rec.country ? `<span class="country">${rec.country}</span>` : ''}
          </div>
          ${rec.genres ? `<div class="card-genres">${rec.genres}</div>` : ''}
          <div class="recommendation-info">
            <span class="rec-score">ƒêi·ªÉm: ${rec.recommendationScore.toFixed(2)}</span>
            <div class="debug-info" style="font-size: 0.8rem; color: #888;">
              <div>ID: ${rec.movieId}</div>
              <div>Score: ${rec.recommendationScore.toFixed(4)}</div>
              <div>AvgRating: ${(rec.avgRating ?? rec.avg_rating ?? 0).toFixed(2)}</div>
              <div>UserRatings: ${rec.ratingCount ?? rec.total_ratings ?? 0}</div>
            </div>
            <div class="recommendation-reason">
              <small>${rec.reason}</small>
            </div>
          </div>
          <div class="movie-rating" data-movie-id="${rec.movieId}">
            <span class="rating-stars">‚≠ê ${(rec.avgRating ?? rec.avg_rating ?? 0).toFixed(1)}</span>
            <span class="rating-count">(${rec.ratingCount ?? rec.total_ratings ?? 0})</span>
          </div>
        </div>
      </a>
      <div class="card-actions">
        <button class="btn-icon" onclick="toggleFavorite(${rec.movieId}, event)" title="Y√™u th√≠ch">
          <span class="heart-icon">ü§ç</span>
        </button>
        <button class="btn-icon" onclick="toggleWatchlist(${rec.movieId}, event)" title="Th√™m v√†o danh s√°ch">
          <span class="watchlist-icon">üìã</span>
        </button>
      </div>
    </div>
  `).join('');
}

function showPreferenceAnalysis() {
  const analysisBtn = document.getElementById('analysisBtn');
  analysisBtn.disabled = true;
  analysisBtn.innerHTML = '<span class="btn-icon">‚è≥</span>ƒêang ph√¢n t√≠ch...';
  
  fetch('/api/user_preference_analysis')
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        displayPreferenceAnalysis(data.analysis);
      } else {
        showToast(data.message, 'error');
      }
    })
    .catch(error => {
      console.error('Error analyzing preferences:', error);
      showToast('C√≥ l·ªói x·∫£y ra khi ph√¢n t√≠ch s·ªü th√≠ch', 'error');
    })
    .finally(() => {
      analysisBtn.disabled = false;
      analysisBtn.innerHTML = '<span class="btn-icon">üìä</span>Ph√¢n t√≠ch s·ªü th√≠ch';
    });
}

function displayPreferenceAnalysis(analysis) {
  const modal = document.createElement('div');
  modal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
  `;
  
  modal.innerHTML = `
    <div style="
      background: white;
      padding: 30px;
      border-radius: 12px;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      color: #333;
    ">
      <h2 style="margin-bottom: 20px; color: #2c3e50;">üìä Ph√¢n t√≠ch s·ªü th√≠ch c·ªßa b·∫°n</h2>
      
      <div style="margin-bottom: 20px;">
        <h3>üìà Th·ªëng k√™ t·ªïng quan</h3>
        <p><strong>T·ªïng s·ªë ƒë√°nh gi√°:</strong> ${analysis.total_ratings}</p>
        <p><strong>ƒêi·ªÉm trung b√¨nh:</strong> ${analysis.average_rating}/5.0</p>
        <p><strong>ƒê·ªô ƒëa d·∫°ng s·ªü th√≠ch:</strong> ${(analysis.diversity_score * 100).toFixed(0)}%</p>
      </div>
      
      <div style="margin-bottom: 20px;">
        <h3>üé≠ Th·ªÉ lo·∫°i y√™u th√≠ch</h3>
        ${analysis.preferred_genres.map(genre => 
          `<p><strong>${genre.genre}:</strong> ${genre.avg_rating}/5.0 (${genre.rating_count} phim)</p>`
        ).join('')}
      </div>
      
      <div style="margin-bottom: 20px;">
        <h3>üìÖ NƒÉm ph√°t h√†nh y√™u th√≠ch</h3>
        ${analysis.preferred_years.map(year => 
          `<p><strong>${year.year}:</strong> ${year.avg_rating}/5.0 (${year.rating_count} phim)</p>`
        ).join('')}
      </div>
      
      <div style="margin-bottom: 20px;">
        <h3>üåç Qu·ªëc gia y√™u th√≠ch</h3>
        ${analysis.preferred_countries.map(country => 
          `<p><strong>${country.country}:</strong> ${country.avg_rating}/5.0 (${country.rating_count} phim)</p>`
        ).join('')}
      </div>
      
      <button onclick="this.closest('div').parentNode.remove()" style="
        background: #e74c3c;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        float: right;
      ">ƒê√≥ng</button>
    </div>
  `;
  
  document.body.appendChild(modal);
}

// Load personalized recommendations on page load
document.addEventListener('DOMContentLoaded', function() {
  // Load recommendations after a short delay to ensure page is ready
  setTimeout(() => {
    loadPersonalizedRecommendations();
    loadModelStatus();
  }, 1000);
});

// Load model status
function loadModelStatus() {
    fetch('/api/model_status_public')
        .then(response => response.json())
        .then(data => {
            const modelInfo = document.getElementById('modelInfo');
            if (modelInfo) {
                if (data.success && data.modelInfo) {
                    const info = data.modelInfo;
                    const status = (info.status || '').toLowerCase();
                    
                    if (status === 'loaded') {
                        // Hi·ªÉn th·ªã th√¥ng tin chi ti·∫øt model
                        const modelType = info.model_type || 'CF';
                        const nUsers = info.n_users || 0;
                        const nItems = info.n_items || 0;
                        const nFactors = info.n_factors || 20;
                        
                        // T·∫°o badge m√†u s·∫Øc cho model type
                        const isEnhanced = modelType.includes('Enhanced');
                        const badge = isEnhanced 
                            ? `<span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; margin-left: 5px;">ENHANCED</span>`
                            : `<span style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; margin-left: 5px;">BASIC</span>`;
                        
                        modelInfo.innerHTML = `‚úÖ Model${badge} | Users: ${nUsers} | Items: ${nItems} | Factors: ${nFactors}`;
                        modelInfo.style.color = '#4ecdc4';
                    } else if (status === 'not loaded') {
                        modelInfo.innerHTML = `‚ö†Ô∏è Model: Ch∆∞a t·∫£i`;
                        modelInfo.style.color = '#f39c12';
                    } else {
                        modelInfo.innerHTML = `‚ö†Ô∏è Model: ${info.status || 'Unknown'}`;
                        modelInfo.style.color = '#ff6b6b';
                    }
                } else {
                    modelInfo.innerHTML = `‚ùå Model: ${data.message || 'Not available'}`;
                    modelInfo.style.color = '#ff6b6b';
                }
            }
        })
        .catch(error => {
            console.error('Error loading model status:', error);
            const modelInfo = document.getElementById('modelInfo');
            if (modelInfo) {
                modelInfo.innerHTML = '‚ùå L·ªói t·∫£i th√¥ng tin model';
                modelInfo.style.color = '#ff6b6b';
            }
        });
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  // Load cold start recommendations if user is new
  console.log('Loading cold start recommendations...');
  loadColdStartRecommendations();
});

// Function to load cold start recommendations
function loadColdStartRecommendations() {
  const coldStartSection = document.getElementById('coldStartSection');
  const interactionCount = document.getElementById('interactionCount');
  
  console.log('Cold start section element:', coldStartSection);
  
  if (!coldStartSection) {
    console.log('Cold start section not found, returning');
    return;
  }
  
  console.log('Checking user interaction status...');
  
  // Check user interaction status
  fetch('/api/user_interaction_status')
    .then(response => response.json())
    .then(data => {
      console.log('Interaction status response:', data);
      
      if (data.success) {
        const totalInteractions = data.rating_count + data.view_count;
        interactionCount.textContent = `B·∫°n ƒë√£ t∆∞∆°ng t√°c ${totalInteractions} l·∫ßn`;
        
        console.log(`Total interactions: ${totalInteractions}`);
        
        if (totalInteractions < 5) {
          // Show cold start section
          console.log('Showing cold start section');
          coldStartSection.style.display = 'block';
          loadColdStartData();
        } else {
          // Hide cold start section
          console.log('Hiding cold start section - user has enough interactions');
          coldStartSection.style.display = 'none';
        }
      } else {
        console.log('Failed to get interaction status:', data.message);
      }
    })
    .catch(error => {
      console.error('Error checking interaction status:', error);
    });
}

// Function to load cold start data
function loadColdStartData() {
  const loading = document.getElementById('coldStartLoading');
  const container = document.getElementById('coldStartRecommendations');
  
  loading.style.display = 'block';
  container.innerHTML = '';
  
  fetch('/api/cold_start_recommendations')
    .then(response => response.json())
    .then(data => {
      loading.style.display = 'none';
      
      if (data.success && data.recommendations) {
        displayColdStartRecommendations(data.recommendations);
      } else {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üé¨</div>
            <h4>Ch∆∞a c√≥ g·ª£i √Ω</h4>
            <p>H·ªá th·ªëng ƒëang t·∫°o g·ª£i √Ω ph√π h·ª£p v·ªõi b·∫°n...</p>
          </div>
        `;
      }
    })
    .catch(error => {
      console.error('Error loading cold start recommendations:', error);
      loading.style.display = 'none';
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">‚ùå</div>
          <h4>C√≥ l·ªói x·∫£y ra</h4>
          <p>Kh√¥ng th·ªÉ t·∫£i g·ª£i √Ω. Vui l√≤ng th·ª≠ l·∫°i sau.</p>
        </div>
      `;
    });
}

// Function to display cold start recommendations
function displayColdStartRecommendations(recommendations) {
  const container = document.getElementById('coldStartRecommendations');
  
  if (recommendations.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">üé¨</div>
        <h4>Ch∆∞a c√≥ g·ª£i √Ω</h4>
        <p>H·ªá th·ªëng ƒëang t·∫°o g·ª£i √Ω ph√π h·ª£p v·ªõi b·∫°n...</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = recommendations.map(rec => `
    <div class="card">
      <a href="/detail/${rec.movieId}" class="card-link">
        <div class="poster" style="background-image:url('${rec.posterUrl || '/static/img/no-poster.jpg'}')"></div>
        <div class="card-content">
          <div class="card-title">${rec.title}</div>
          <div class="card-meta">
            ${rec.releaseYear ? `<span class="year">${rec.releaseYear}</span>` : ''}
            ${rec.country ? `<span class="country">${rec.country}</span>` : ''}
          </div>
          ${rec.genres ? `<div class="card-genres">${rec.genres}</div>` : ''}
          <div class="recommendation-info">
            <span class="rec-badge cold-start-badge">${rec.source === 'preference_genre' ? 'D·ª±a tr√™n s·ªü th√≠ch' : 'Ph·ªï bi·∫øn'}</span>
            <div class="rec-reason">${rec.reason || ''}</div>
          </div>
          <div class="movie-rating" data-movie-id="${rec.movieId}">
            <span class="rating-stars">‚≠ê ${rec.avgRating ? rec.avgRating.toFixed(1) : '0.0'}</span>
            <span class="rating-count">(${rec.ratingCount || 0})</span>
          </div>
        </div>
      </a>
      <div class="action-buttons">
        <button class="favorite-btn" onclick="toggleFavorite(${rec.movieId}, event)" data-movie-id="${rec.movieId}">
          <span class="favorite-icon">ü§ç</span>
        </button>
        <button class="watchlist-btn" onclick="toggleWatchlist(${rec.movieId}, event)" data-movie-id="${rec.movieId}">
          <span class="watchlist-icon">üìã</span>
        </button>
      </div>
    </div>
  `).join('');
}
</script>
{% endblock %}


