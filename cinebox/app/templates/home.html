{% extends 'base.html' %}
{% block title %}{% if genre_filter %}{{ genre_filter }} ¬∑ CineBox{% else %}Trang ch·ªß ¬∑ CineBox{% endif %}{% endblock %}
{% block content %}
<section class="hero">
  <div class="hero-carousel">
    {% if carousel_movies %}
      {% for movie in carousel_movies %}
      <div class="hero-slide {{ 'active' if loop.first else '' }}" data-slide="{{ loop.index0 }}">
        <div class="hero-backdrop" style="background-image: url('{{ movie.backdrop }}')"></div>
        <div class="hero-overlay"></div>
        <div class="hero-content">
          <div class="hero-poster">
            <img src="{{ movie.poster }}" alt="{{ movie.title }}" class="poster-img" onerror="this.src='/static/img/dune2.jpg'">
          </div>
          <div class="hero-text">
            <span class="badge">{% if genre_filter %}{{ genre_filter }}{% else %}NEW{% endif %}</span>
            <h1>{{ movie.title }}</h1>
            <p class="hero-description">{{ movie.description }}</p>
            <div class="hero-actions">
              <a class="btn btn-primary" href="{{ url_for('main.watch', movie_id=movie.id) }}">
                <span class="btn-icon">‚ñ∂</span>
                Xem ngay
              </a>
              <a class="btn btn-secondary" href="{{ url_for('main.detail', movie_id=movie.id) }}">
                <span class="btn-icon">+</span>
                Th√™m v√†o danh s√°ch
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <!-- Fallback khi kh√¥ng c√≥ phim -->
      <div class="hero-slide active">
        <div class="hero-backdrop" style="background-image: url('/static/img/dune2_backdrop.jpg')"></div>
        <div class="hero-overlay"></div>
        <div class="hero-content">
          <div class="hero-poster">
            <img src="/static/img/dune2.jpg" alt="Dune 2" class="poster-img">
          </div>
          <div class="hero-text">
            <span class="badge">{% if genre_filter %}{{ genre_filter }}{% else %}NEW{% endif %}</span>
            <h1>Dune: Part Two (2024)</h1>
            <p class="hero-description">Paul Atreides unites with Chani and the Fremen while seeking revenge against the conspirators who destroyed his family.</p>
            <div class="hero-actions">
              <a class="btn btn-primary" href="#">
                <span class="btn-icon">‚ñ∂</span>
                Xem ngay
              </a>
              <a class="btn btn-secondary" href="#">
                <span class="btn-icon">+</span>
                Th√™m v√†o danh s√°ch
              </a>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
  
  <!-- Carousel Controls -->
  {% if carousel_movies and carousel_movies|length > 1 %}
  <div class="carousel-controls">
    <button class="carousel-btn prev-btn" onclick="changeSlide(-1)">‚Äπ</button>
    <div class="carousel-dots">
      {% for movie in carousel_movies %}
      <button class="dot {{ 'active' if loop.first else '' }}" onclick="currentSlide({{ loop.index }})"></button>
      {% endfor %}
    </div>
    <button class="carousel-btn next-btn" onclick="changeSlide(1)">‚Ä∫</button>
  </div>
  {% endif %}
</section>

<!-- Genre Filter Menu -->
<section class="genre-filter">
  <div class="genre-filter-container">
    <h3>üé¨ L·ªçc theo th·ªÉ lo·∫°i</h3>
    <div class="genre-buttons">
      <a href="{{ url_for('main.home') }}" 
         class="genre-btn {{ 'active' if not genre_filter else '' }}"
         data-genre="all"
         onclick="window.location.href='{{ url_for('main.home') }}'; return false;">
        üè† Trang ch·ªß
      </a>
      
      <!-- 4 th·ªÉ lo·∫°i ch√≠nh -->
      <a href="{{ url_for('main.home', genre='Action') }}" 
         class="genre-btn {{ 'active' if genre_filter == 'Action' else '' }}"
         data-genre="action">
        üé¨ Action
      </a>
      <a href="{{ url_for('main.home', genre='Adventure') }}" 
         class="genre-btn {{ 'active' if genre_filter == 'Adventure' else '' }}"
         data-genre="adventure">
        üó∫Ô∏è Adventure
      </a>
      <a href="{{ url_for('main.home', genre='Comedy') }}" 
         class="genre-btn {{ 'active' if genre_filter == 'Comedy' else '' }}"
         data-genre="comedy">
        üòÇ Comedy
      </a>
      <a href="{{ url_for('main.home', genre='Horror') }}" 
         class="genre-btn {{ 'active' if genre_filter == 'Horror' else '' }}"
         data-genre="horror">
        üëª Horror
      </a>
      
      <!-- Ch·ªâ hi·ªÉn th·ªã th·ªÉ lo·∫°i ƒë∆∞·ª£c ch·ªçn (n·∫øu kh√¥ng ph·∫£i 4 th·ªÉ lo·∫°i ch√≠nh) -->
      {% if genre_filter and genre_filter not in ['Action', 'Adventure', 'Comedy', 'Horror'] %}
        <a href="{{ url_for('main.genre_page', genre_slug=genre_filter.lower().replace(' ', '-')) }}" 
           class="genre-btn active"
           data-genre="{{ genre_filter.lower().replace(' ', '-') }}">
          {{ genre_filter }}
        </a>
      {% endif %}
    </div>
  </div>
</section>

<!-- 1. Phim m·ªõi nh·∫•t (12 phim, kh√¥ng ph√¢n trang) - ch·ªâ hi·ªÉn th·ªã khi kh√¥ng c√≥ genre filter -->
{% if not genre_filter %}
<section>
  <h3>üÜï Phim m·ªõi nh·∫•t</h3>
  <div class="cards">
    {% for m in latest_movies %}
    <a class="card" href="{{ url_for('main.detail', movie_id=m.id) }}">
      <div class="poster" style="background-image:url('{{ m.poster }}')"></div>
      <div class="card-title">{{ m.title }}</div>
      <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
    </a>
    {% endfor %}
  </div>
</section>
{% else %}
<!-- Hi·ªÉn th·ªã phim m·ªõi nh·∫•t c·ªßa th·ªÉ lo·∫°i ƒë∆∞·ª£c ch·ªçn -->
<section>
  <h3>üÜï Phim {{ genre_filter }} m·ªõi nh·∫•t</h3>
  <div class="cards">
    {% for m in latest_movies %}
    <a class="card" href="{{ url_for('main.detail', movie_id=m.id) }}">
      <div class="poster" style="background-image:url('{{ m.poster }}')"></div>
      <div class="card-title">{{ m.title }}</div>
      <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
    </a>
    {% endfor %}
  </div>
</section>
{% endif %}


<!-- 2. Phim ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t cho b·∫°n (ch·ªâ hi·ªÉn th·ªã khi kh√¥ng c√≥ genre filter) -->
{% if not genre_filter %}
<section>
  <h3>Phim ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t cho b·∫°n</h3>
  <div class="cards">
    {% for m in recommended %}
    <a class="card" href="{{ url_for('main.detail', movie_id=m.id) }}">
      <div class="poster" style="background-image:url('{{ m.poster }}')"></div>
      <div class="card-title">{{ m.title }}</div>
      <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
    </a>
    {% endfor %}
  </div>
</section>
{% endif %}

<!-- 3. T·∫•t c·∫£ phim (c√≥ ph√¢n trang) -->
{% if all_movies %}
<section class="all-movies movies-section">
  <div class="section-header">
    {% if search_query %}
      <h3>üîç K·∫øt qu·∫£ t√¨m ki·∫øm cho "{{ search_query }}"</h3>
    {% elif genre_filter %}
      <h3>üé¨ Phim {{ genre_filter }}</h3>
    {% else %}
      <h3>üé¨ T·∫•t c·∫£ phim</h3>
    {% endif %}
  </div>
  
  <div class="cards movies-grid">
    {% for m in all_movies %}
    <a class="card" href="{{ url_for('main.detail', movie_id=m.id) }}">
      <div class="poster" style="background-image:url('{{ m.poster }}')"></div>
      <div class="card-content">
        <div class="card-title">{{ m.title }}</div>
        <div class="card-meta">
          <span class="upload-time">Phim {{ m.id }}</span>
        </div>
        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      </div>
    </a>
    {% endfor %}
  </div>
  
  <!-- Pagination -->
  {% if pagination and pagination.pages > 1 %}
  <div class="pagination">
    <div class="pagination-info page-info">
      <span>Trang {{ pagination.page }} / {{ pagination.pages }}</span>
      <span>({{ pagination.total }} phim)</span>
    </div>
    
    <div class="pagination-controls">
      {% if pagination.has_prev %}
        <a href="{{ url_for('main.home', page=pagination.prev_num, q=search_query, genre=genre_filter) }}" class="btn btn-pagination">
          ‚Üê Trang tr∆∞·ªõc
        </a>
      {% endif %}
      
      <div class="page-numbers">
        {% set start_page = [1, pagination.page - 2]|max %}
        {% set end_page = [pagination.pages, pagination.page + 2]|min %}
        
        {% if start_page > 1 %}
          <a href="{{ url_for('main.home', page=1, q=search_query, genre=genre_filter) }}" class="page-number">1</a>
          {% if start_page > 2 %}
            <span class="page-ellipsis">...</span>
          {% endif %}
        {% endif %}
        
        {% for page_num in range(start_page, end_page + 1) %}
          {% if page_num == pagination.page %}
            <span class="page-number current">{{ page_num }}</span>
          {% else %}
            <a href="{{ url_for('main.home', page=page_num, q=search_query, genre=genre_filter) }}" class="page-number">{{ page_num }}</a>
          {% endif %}
        {% endfor %}
        
        {% if end_page < pagination.pages %}
          {% if end_page < pagination.pages - 1 %}
            <span class="page-ellipsis">...</span>
          {% endif %}
          <a href="{{ url_for('main.home', page=pagination.pages, q=search_query, genre=genre_filter) }}" class="page-number">{{ pagination.pages }}</a>
        {% endif %}
      </div>
      
      {% if pagination.has_next %}
        <a href="{{ url_for('main.home', page=pagination.next_num, q=search_query, genre=genre_filter) }}" class="btn btn-pagination">
          Trang sau ‚Üí
        </a>
      {% endif %}
    </div>
  </div>
  {% endif %}
</section>
{% endif %}

<style>
/* Hero Section */
.hero {
  position: relative;
  min-height: 65vh;
  margin-bottom: 30px;
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
}

.hero-carousel {
  position: relative;
  width: 100%;
  height: 100%;
}

.hero-slide {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  transition: opacity 1s ease-in-out;
}

.hero-slide.active {
  opacity: 1;
}

.hero-backdrop {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  filter: blur(3px);
  transform: scale(1.1);
}

.hero-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.4));
  z-index: 1;
}

.hero-content {
  position: relative;
  z-index: 2;
  display: flex;
  align-items: center;
  min-height: 65vh;
  padding: 30px;
  max-width: 1000px;
  margin: 0 auto;
  gap: 30px;
}

.hero-poster {
  flex-shrink: 0;
  width: 220px;
  height: 330px;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.1);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
}

.hero-poster::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, rgba(255, 107, 107, 0.1), rgba(255, 255, 255, 0.05));
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 1;
}

.hero-poster:hover {
  transform: scale(1.08) translateY(-5px);
  box-shadow: 0 30px 70px rgba(0, 0, 0, 0.8), 0 0 0 2px rgba(255, 107, 107, 0.3);
}

.hero-poster:hover::before {
  opacity: 1;
}

.poster-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  z-index: 2;
}

.hero-poster:hover .poster-img {
  transform: scale(1.05);
}

.hero-text {
  flex: 1;
  color: white;
}

.badge {
  display: inline-block;
  background: linear-gradient(135deg, #ff6b6b, #ee5a24);
  color: white;
  padding: 10px 20px;
  border-radius: 30px;
  font-size: 0.95rem;
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin-bottom: 25px;
  box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
  position: relative;
  overflow: hidden;
}

.badge::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

.badge:hover::before {
  left: 100%;
}

.hero-text h1 {
  font-size: 2.8rem;
  font-weight: 800;
  margin: 0 0 15px 0;
  line-height: 1.1;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  background: linear-gradient(135deg, #fff, #e0e0e0);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero-description {
  font-size: 1.1rem;
  line-height: 1.5;
  margin: 0 0 25px 0;
  color: rgba(255, 255, 255, 0.9);
  max-width: 500px;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

.hero-actions {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 60px; /* Add space to prevent overlap with carousel controls */
}

.hero-actions .btn {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 18px 35px;
  font-size: 1.15rem;
  font-weight: 700;
  border-radius: 50px;
  text-decoration: none;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
  position: relative;
  overflow: hidden;
}

.hero-actions .btn-primary {
  background: linear-gradient(135deg, #ff6b6b, #ee5a24);
  color: white;
  border: none;
}

.hero-actions .btn-primary:hover {
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 15px 40px rgba(255, 107, 107, 0.5);
  background: linear-gradient(135deg, #ff7b7b, #ff6b24);
}

.hero-actions .btn-secondary {
  background: rgba(255, 255, 255, 0.1);
  color: white;
  border: 2px solid rgba(255, 255, 255, 0.3);
  backdrop-filter: blur(10px);
}

.hero-actions .btn-secondary:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.6);
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 15px 40px rgba(255, 255, 255, 0.2);
}

.btn-icon {
  font-size: 1.2rem;
}

/* Carousel Controls */
.carousel-controls {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 40px;
  z-index: 10;
}

.carousel-btn {
  background: rgba(255, 255, 255, 0.2);
  border: 2px solid rgba(255, 255, 255, 0.3);
  color: white;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  font-size: 1.5rem;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
}

.carousel-btn:hover {
  background: rgba(255, 255, 255, 0.3);
  border-color: rgba(255, 255, 255, 0.5);
  transform: scale(1.1);
}

.carousel-dots {
  display: flex;
  gap: 8px;
}

.dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: none;
  background: rgba(255, 255, 255, 0.4);
  cursor: pointer;
  transition: all 0.3s ease;
}

.dot.active {
  background: #ff6b6b;
  transform: scale(1.2);
}

.dot:hover {
  background: rgba(255, 255, 255, 0.7);
}

/* Responsive Design */
@media (max-width: 768px) {
  .hero-content {
    flex-direction: column;
    text-align: center;
    padding: 20px;
    gap: 20px;
  }
  
  .hero-poster {
    width: 180px;
    height: 270px;
  }
  
  .hero-text h1 {
    font-size: 2.5rem;
  }
  
  .hero-description {
    font-size: 1rem;
  }
  
  .hero-actions {
    justify-content: center;
  }
  
  .carousel-controls {
    bottom: 10px;
    gap: 30px;
  }
  
  .carousel-btn {
    width: 35px;
    height: 35px;
    font-size: 1.2rem;
  }
  
  .dot {
    width: 10px;
    height: 10px;
  }
}

/* Genre Filter Section */
.genre-filter {
  margin: 20px 0 40px 0;
  padding: 20px 0;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
  border-radius: 15px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.genre-filter-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.genre-filter h3 {
  color: #fff;
  font-size: 1.3rem;
  margin: 0 0 20px 0;
  text-align: center;
  font-weight: 600;
}

.genre-buttons {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
}

.genre-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 20px;
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  text-decoration: none;
  border-radius: 25px;
  font-weight: 500;
  font-size: 0.95rem;
  transition: all 0.3s ease;
  border: 2px solid transparent;
  backdrop-filter: blur(10px);
}

.genre-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  color: #fff;
  text-decoration: none;
}

.genre-btn.active {
  background: linear-gradient(135deg, #ff6b35, #f7931e);
  border-color: #ff6b35;
  box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
  color: #fff;
  font-weight: 600;
}

.genre-btn.active:hover {
  background: linear-gradient(135deg, #ff7b45, #ffa31e);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(255, 107, 53, 0.5);
}

/* Responsive */
@media (max-width: 768px) {
  .genre-buttons {
    gap: 8px;
  }
  
  .genre-btn {
    padding: 10px 16px;
    font-size: 0.9rem;
  }
  
  .genre-filter h3 {
    font-size: 1.1rem;
  }
}

/* All Movies Section */
.all-movies {
  margin: 40px 0;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.section-header h3 {
  color: #fff;
  font-size: 1.5rem;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 8px;
}

.section-info {
  color: #888;
  font-size: 0.9rem;
}

.movie-count {
  background: rgba(255, 255, 255, 0.1);
  padding: 4px 12px;
  border-radius: 12px;
  backdrop-filter: blur(10px);
}

.card-content {
  padding: 12px;
}

.card-meta {
  margin: 5px 0;
  font-size: 0.8rem;
}

.upload-time {
  color: #4CAF50;
  font-weight: bold;
  background: rgba(76, 175, 80, 0.1);
  padding: 2px 8px;
  border-radius: 8px;
}

/* Pagination Styles */
.pagination {
  margin-top: 30px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

.pagination-info {
  color: #888;
  font-size: 0.9rem;
  display: flex;
  gap: 10px;
}

.pagination-controls {
  display: flex;
  align-items: center;
  gap: 15px;
}

.btn-pagination {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: #fff;
  padding: 8px 16px;
  border-radius: 6px;
  text-decoration: none;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.btn-pagination:hover {
  background: rgba(255, 255, 255, 0.2);
  border-color: rgba(255, 255, 255, 0.4);
  transform: translateY(-1px);
}

.page-numbers {
  display: flex;
  gap: 5px;
  align-items: center;
}

.page-number {
  display: inline-block;
  padding: 8px 12px;
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  text-decoration: none;
  border-radius: 6px;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  min-width: 40px;
  text-align: center;
}

.page-number:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-1px);
}

.page-number.current {
  background: #e50914;
  color: #fff;
  font-weight: bold;
}

.page-ellipsis {
  color: #888;
  padding: 8px 4px;
  font-size: 0.9rem;
}

/* Responsive */
@media (max-width: 768px) {
  .section-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .pagination-controls {
    flex-direction: column;
    gap: 10px;
  }
  
  .page-numbers {
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .btn-pagination {
    padding: 6px 12px;
    font-size: 0.8rem;
  }
  
  .page-number {
    padding: 6px 10px;
    font-size: 0.8rem;
    min-width: 35px;
  }
}

/* AJAX Loading States */
.movies-grid {
  transition: opacity 0.3s ease;
}

.movies-grid.loading {
  opacity: 0.7;
}

.genre-btn {
  transition: all 0.3s ease;
}

.genre-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.page-number {
  transition: all 0.3s ease;
}

.page-number:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* Smooth scrolling */
html {
  scroll-behavior: smooth;
}
</style>

<script>
// AJAX Pagination, Genre Filter, and Search
document.addEventListener('DOMContentLoaded', function() {
    // Attach pagination listeners
    attachPaginationListeners();
    
    // Attach genre filter listeners
    attachGenreFilterListeners();
    
    // Attach search listeners
    attachSearchListeners();
});

function attachGenreFilterListeners() {
    const genreLinks = document.querySelectorAll('.genre-btn');
    
    genreLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            const genre = this.getAttribute('data-genre');
            
            // N·∫øu l√† "T·∫•t c·∫£" th√¨ d√πng AJAX, c√°c th·ªÉ lo·∫°i kh√°c th√¨ chuy·ªÉn trang
            if (genre === 'all') {
                e.preventDefault();
                
                const url = this.href;
                
                // Show loading indicator
                showLoading();
                
                // Add loading class to movies grid
                const moviesGrid = document.querySelector('.movies-grid');
                if (moviesGrid) {
                    moviesGrid.classList.add('loading');
                }
                
                // Fetch new page content
                fetch(url)
                .then(response => response.text())
                .then(html => {
                    // Parse the response
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Update the movies grid
                    const newMoviesGrid = doc.querySelector('.movies-grid');
                    const currentMoviesGrid = document.querySelector('.movies-grid');
                    if (newMoviesGrid && currentMoviesGrid) {
                        currentMoviesGrid.innerHTML = newMoviesGrid.innerHTML;
                    }
                    
                    // Update pagination
                    const newPagination = doc.querySelector('.pagination-controls');
                    const currentPagination = document.querySelector('.pagination-controls');
                    if (newPagination && currentPagination) {
                        currentPagination.innerHTML = newPagination.innerHTML;
                        // Re-attach event listeners to new pagination links
                        attachPaginationListeners();
                    }
                    
                    // Update page info
                    const newPageInfo = doc.querySelector('.page-info');
                    const currentPageInfo = document.querySelector('.page-info');
                    if (newPageInfo && currentPageInfo) {
                        currentPageInfo.innerHTML = newPageInfo.innerHTML;
                    }
                    
                    // Update genre filter active state
                    const newGenreFilter = doc.querySelector('.genre-filter');
                    const currentGenreFilter = document.querySelector('.genre-filter');
                    if (newGenreFilter && currentGenreFilter) {
                        currentGenreFilter.innerHTML = newGenreFilter.innerHTML;
                        // Re-attach event listeners to new genre links
                        attachGenreFilterListeners();
                    }
                    
                    // Update section title
                    const newSectionTitle = doc.querySelector('.movies-section h3');
                    const currentSectionTitle = document.querySelector('.movies-section h3');
                    if (newSectionTitle && currentSectionTitle) {
                        currentSectionTitle.innerHTML = newSectionTitle.innerHTML;
                    }
                    
                    // Update section info
                    const newSectionInfo = doc.querySelector('.section-info');
                    const currentSectionInfo = document.querySelector('.section-info');
                    if (newSectionInfo && currentSectionInfo) {
                        currentSectionInfo.innerHTML = newSectionInfo.innerHTML;
                    }
                    
                    // Scroll to top of movies section
                    const moviesSection = document.querySelector('.movies-section');
                    if (moviesSection) {
                        moviesSection.scrollIntoView({ behavior: 'smooth' });
                    }
                    
                    // Update URL without reload
                    window.history.pushState({}, '', url);
                    
                    // Remove loading class
                    const moviesGrid = document.querySelector('.movies-grid');
                    if (moviesGrid) {
                        moviesGrid.classList.remove('loading');
                    }
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error loading page:', error);
                    
                    // Remove loading class
                    const moviesGrid = document.querySelector('.movies-grid');
                    if (moviesGrid) {
                        moviesGrid.classList.remove('loading');
                    }
                    
                    hideLoading();
                    // Fallback to normal page reload
                    window.location.href = url;
                });
            } else {
                // C√°c th·ªÉ lo·∫°i kh√°c: chuy·ªÉn trang b√¨nh th∆∞·ªùng
                // Kh√¥ng preventDefault, ƒë·ªÉ link ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng
            }
        });
    });
}

function attachPaginationListeners() {
    const paginationLinks = document.querySelectorAll('.pagination-controls a');
    
    paginationLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            const url = this.href;
            
            // Show loading indicator
            showLoading();
            
            // Add loading class to movies grid
            const moviesGrid = document.querySelector('.movies-grid');
            if (moviesGrid) {
                moviesGrid.classList.add('loading');
            }
            
            // Fetch new page content
            fetch(url)
                .then(response => response.text())
                .then(html => {
                    // Parse the response
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Update the movies grid
                    const newMoviesGrid = doc.querySelector('.movies-grid');
                    const currentMoviesGrid = document.querySelector('.movies-grid');
                    if (newMoviesGrid && currentMoviesGrid) {
                        currentMoviesGrid.innerHTML = newMoviesGrid.innerHTML;
                    }
                    
                    // Update pagination
                    const newPagination = doc.querySelector('.pagination-controls');
                    const currentPagination = document.querySelector('.pagination-controls');
                    if (newPagination && currentPagination) {
                        currentPagination.innerHTML = newPagination.innerHTML;
                        // Re-attach event listeners to new pagination links
                        attachPaginationListeners();
                    }
                    
                    // Update page info
                    const newPageInfo = doc.querySelector('.page-info');
                    const currentPageInfo = document.querySelector('.page-info');
                    if (newPageInfo && currentPageInfo) {
                        currentPageInfo.innerHTML = newPageInfo.innerHTML;
                    }
                    
                    // Scroll to top of movies section
                    const moviesSection = document.querySelector('.movies-section');
                    if (moviesSection) {
                        moviesSection.scrollIntoView({ behavior: 'smooth' });
                    }
                    
                    // Update URL without reload
                    window.history.pushState({}, '', url);
                    
                    // Remove loading class
                    const moviesGrid = document.querySelector('.movies-grid');
                    if (moviesGrid) {
                        moviesGrid.classList.remove('loading');
                    }
                    
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error loading page:', error);
                    
                    // Remove loading class
                    const moviesGrid = document.querySelector('.movies-grid');
                    if (moviesGrid) {
                        moviesGrid.classList.remove('loading');
                    }
                    
                    hideLoading();
                    // Fallback to normal page reload
                    window.location.href = url;
                });
        });
    });
}

function showLoading() {
    // Create loading overlay
    let loadingOverlay = document.getElementById('loading-overlay');
    if (!loadingOverlay) {
        loadingOverlay = document.createElement('div');
        loadingOverlay.id = 'loading-overlay';
        loadingOverlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        `;
        
        const loadingSpinner = document.createElement('div');
        loadingSpinner.style.cssText = `
            width: 50px;
            height: 50px;
            border: 5px solid #333;
            border-top: 5px solid #e50914;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        `;
        
        loadingOverlay.appendChild(loadingSpinner);
        document.body.appendChild(loadingOverlay);
        
        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    }
    loadingOverlay.style.display = 'flex';
}

function hideLoading() {
    const loadingOverlay = document.getElementById('loading-overlay');
    if (loadingOverlay) {
        loadingOverlay.style.display = 'none';
    }
}

function attachSearchListeners() {
    const searchInput = document.getElementById('headerSearchInput');
    const searchForm = document.querySelector('.search');
    
    if (searchForm) {
        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const query = searchInput.value.trim();
            if (query.length < 2) {
                return;
            }
            
            // Redirect to home page with search query
            const url = new URL(window.location.origin + '/');
            url.searchParams.set('q', query);
            window.location.href = url.toString();
        });
    }
}

// Carousel functionality
let currentSlideIndex = 0;
let slideInterval;
const slides = document.querySelectorAll('.hero-slide');
const dots = document.querySelectorAll('.dot');
const totalSlides = slides.length;

function showSlide(index) {
    // Remove active class from all slides and dots
    slides.forEach(slide => slide.classList.remove('active'));
    dots.forEach(dot => dot.classList.remove('active'));
    
    // Add active class to current slide and dot
    if (slides[index]) {
        slides[index].classList.add('active');
    }
    if (dots[index]) {
        dots[index].classList.add('active');
    }
    
    currentSlideIndex = index;
}

function nextSlide() {
    const nextIndex = (currentSlideIndex + 1) % totalSlides;
    showSlide(nextIndex);
}

function prevSlide() {
    const prevIndex = (currentSlideIndex - 1 + totalSlides) % totalSlides;
    showSlide(prevIndex);
}

function changeSlide(direction) {
    clearInterval(slideInterval);
    if (direction === 1) {
        nextSlide();
    } else {
        prevSlide();
    }
    // Reset timer - ƒë·∫øm l·∫°i t·ª´ ƒë·∫ßu
    setTimeout(startAutoSlide, 100);
}

function currentSlide(index) {
    clearInterval(slideInterval);
    showSlide(index - 1);
    // Reset timer - ƒë·∫øm l·∫°i t·ª´ ƒë·∫ßu
    setTimeout(startAutoSlide, 100);
}

function startAutoSlide() {
    slideInterval = setInterval(nextSlide, 7000); // 7 seconds
}

function stopAutoSlide() {
    clearInterval(slideInterval);
}

// Initialize carousel
document.addEventListener('DOMContentLoaded', function() {
    if (totalSlides > 0) {
        showSlide(0);
        startAutoSlide();
        
        // Pause on hover
        const hero = document.querySelector('.hero');
        if (hero) {
            hero.addEventListener('mouseenter', stopAutoSlide);
            hero.addEventListener('mouseleave', startAutoSlide);
        }
    }
});
</script>
{% endblock %}


